(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97632,e=>{"use strict";var t=e.i(81743),r=e.i(62697),n=e.i(29819);let i=(0,n.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),s=(0,n.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),a=(0,n.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function o({currentTier:e="DIY"}){let[n,o]=(0,r.useState)(!1),l=(e=>{switch(e){case"DIY":return[{label:"Upgrade to Do-It-With-You",price:"$250",id:"UPGRADE_DIY_DWY"},{label:"Upgrade to Do-It-For-You",price:"$500",id:"UPGRADE_DIY_DFY"}];case"DWY":return[{label:"Upgrade to Do-It-For-You",price:"$250",id:"UPGRADE_DWY_DFY"}];case"DFY":return[{label:"Book Advisory Session",price:"$4,500",id:"CAPITAL_READINESS_ADVISORY"}];default:return[]}})(e);return(0,t.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-4",children:[n&&(0,t.jsxs)("div",{className:"bg-white dark:bg-midnight-800 border border-gold-500/30 shadow-2xl rounded-xl p-4 w-80 animate-in slide-in-from-bottom-5 fade-in duration-300",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsxs)("h3",{className:"font-bold text-gold-500 flex items-center gap-2",children:[(0,t.jsx)(i,{size:18}),"Need Help?"]}),(0,t.jsx)("button",{onClick:()=>o(!1),className:"text-slate-400 hover:text-white",children:(0,t.jsx)(a,{size:18})})]}),(0,t.jsx)("p",{className:"text-sm text-slate-300 mb-4",children:"Stuck? Upgrade your plan instantly. We only charge the difference."}),(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("button",{onClick:()=>{console.log("Trigger Upgrade Checkout:",e.id)},className:"w-full flex items-center justify-between p-3 rounded-lg bg-midnight-900 border border-midnight-700 hover:border-gold-500 hover:bg-midnight-700 transition-all group text-left",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-200 group-hover:text-gold-400",children:e.label}),(0,t.jsx)("span",{className:"text-sm font-bold text-gold-500",children:e.price})]},e.id))}),(0,t.jsx)("button",{className:"w-full mt-3 py-2 text-xs text-center text-slate-500 hover:text-slate-300 underline",children:"Contact Support"})]}),(0,t.jsxs)("button",{onClick:()=>o(!n),className:function(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=function e(t){var r,n,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(n=e(t[r]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}(e))&&(n&&(n+=" "),n+=t);return n}("flex items-center gap-2 px-5 py-3 rounded-full font-bold shadow-lg shadow-gold-500/20 transition-all hover:scale-105 active:scale-95",n?"bg-midnight-700 text-white":"bg-gold-500 text-midnight-900"),children:[(0,t.jsx)(i,{size:20}),n?"Close Help":"Panic Button",!n&&(0,t.jsx)(s,{size:16})]})]})}e.s(["PanicButton",()=>o],97632)},98949,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(x(e,ArrayBuffer)||e&&x(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(x(e,SharedArrayBuffer)||e&&x(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||x(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=N[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(x(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function _(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function b(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||b(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function E(e,t,r,n,s){return t*=1,r>>>=0,s||b(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,k(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,k(C(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return k(C(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,k(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,k(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;_(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;_(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);_(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);_(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function C(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/.gemini/antigravity/playground/final-cassini/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},8908,(e,t,r)=>{t.exports=e.r(33334)},54225,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,p,g,m,y,v,w,_,b,I,E,T,S=e.i(81743),C=e.i(62697),A=e.i(65309);let k=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},x=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},N={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(k(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):x(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new D;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class D extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let R=function(e){let t=k(e);return N.encodeByteArray(t,!0)},O=function(e){return R(e).replace(/\./g,"")},P=function(e){try{return N.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function L(){return"u">typeof self?self:"u">typeof window?window:e.g}let M=()=>{try{return L().__FIREBASE_DEFAULTS__||(()=>{if(void 0===A.default||void 0===A.default.env)return;let e=A.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&P(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},F=e=>M()?.emulatorHosts?.[e],V=e=>{let t=F(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},U=()=>M()?.config,B=e=>M()?.[`_${e}`];class j{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function q(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function z(e){return(await fetch(e,{credentials:"include"})).ok}function $(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[O(JSON.stringify({alg:"none",type:"JWT"})),O(JSON.stringify(s)),""].join(".")}let K={},G=!1;function H(e,t){if("u"<typeof window||"u"<typeof document||!q(window.location.host)||K[e]===t||K[e]||G)return;function r(e){return`__firebase__banner__${e}`}K[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(K))K[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;G=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function W(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Q(){let t=M()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function J(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function Y(){return!Q()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function X(){return!Q()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Z(){try{return"object"==typeof indexedDB}catch(e){return!1}}class ee extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,ee.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,et.prototype.create)}}class et{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(er,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ee(s,l,i)}}let er=/\{\$([^}]+)}/g;function en(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(ei(r)&&ei(s)){if(!en(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ei(e){return null!==e&&"object"==typeof e}function es(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function ea(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function eo(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class el{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=eu),void 0===n.error&&(n.error=eu),void 0===n.complete&&(n.complete=eu);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eu(){}function eh(e){return e&&e._delegate?e._delegate:e}class ec{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ed="[DEFAULT]";class ef{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new j;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ed})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ed){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ed){return this.instances.has(e)}getOptions(e=ed){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ed?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ed){return this.component?this.component.multipleInstances?e:ed:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ep{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ef(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eg=[];(i=l||(l={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let em={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},ey=l.INFO,ev={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},ew=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=ev[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class e_{constructor(e){this.name=e,this._logLevel=ey,this._logHandler=ew,this._userLogHandler=null,eg.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?em[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}let eb=new WeakMap,eI=new WeakMap,eE=new WeakMap,eT=new WeakMap,eS=new WeakMap,eC={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eI.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eE.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eA(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eA(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eA(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eb.set(t,e)}).catch(()=>{}),eS.set(t,e),t}if(eT.has(e))return eT.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ek(this),t),eA(eb.get(this))}:function(...t){return eA(e.apply(ek(this),t))}:function(t,...r){let n=e.call(ek(this),t,...r);return eE.set(n,t.sort?t.sort():[t]),eA(n)};return e instanceof IDBTransaction&&function(e){if(eI.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eI.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eC):e}(e);return n!==e&&(eT.set(e,n),eS.set(n,e)),n}let ek=e=>eS.get(e),ex=["get","getKey","getAll","getAllKeys","count"],eN=["put","add","delete","clear"],eD=new Map;function eR(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eD.get(t))return eD.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eN.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ex.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eD.set(t,s),s}eC={...n=eC,get:(e,t,r)=>eR(e,t)||n.get(e,t,r),has:(e,t)=>!!eR(e,t)||n.has(e,t)};class eO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eP="@firebase/app",eL="0.14.7",eM=new e_("@firebase/app"),eF="[DEFAULT]",eV={[eP]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eU=new Map,eB=new Map,ej=new Map;function eq(e,t){try{e.container.addComponent(t)}catch(r){eM.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function ez(e,t){e.container.addOrOverwriteComponent(t)}function e$(e){let t=e.name;if(ej.has(t))return eM.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(ej.set(t,e),eU.values()))eq(r,e);for(let t of eB.values())eq(t,e);return!0}function eK(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eG(e,t,r=eF){eK(e,t).clearInstance(r)}function eH(e){return void 0!==e.options}function eW(e){return!eH(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eQ(e){return null!=e&&void 0!==e.settings}function eJ(){ej.clear()}let eY=new et("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eX{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ec("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eY.create("app-deleted",{appName:this._name})}}function eZ(e,t){let r=P(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e0 extends eX{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&eZ(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eZ(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,e8(eP,eL,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e4(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eY.create("server-app-deleted")}}let e1="12.8.0";function e2(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eF,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw eY.create("bad-app-name",{appName:String(i)});if(r||(r=U()),!r)throw eY.create("no-options");let s=eU.get(i);if(s)if(en(r,s.options)&&en(n,s.config))return s;else throw eY.create("duplicate-app",{appName:i});let a=new ep(i);for(let e of ej.values())a.addComponent(e);let o=new eX(r,n,a);return eU.set(i,o),o}function e6(e,t={}){let r;if(("u">typeof window||J())&&!J())throw eY.create("invalid-server-app-environment");let n=t||{};if(e&&(eH(e)?r=e.options:eW(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=U()),!r)throw eY.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw eY.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=eB.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new ep(s);for(let e of ej.values())o.addComponent(e);let l=new e0(r,n,s,o);return eB.set(s,l),l}function e3(e=eF){let t=eU.get(e);if(!t&&e===eF&&U())return e2();if(!t)throw eY.create("no-app",{appName:e});return t}function e5(){return Array.from(eU.values())}async function e4(e){let t=!1,r=e.name;eU.has(r)?(t=!0,eU.delete(r)):eB.has(r)&&0>=e.decRefCount()&&(eB.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e8(e,t,r){let n=eV[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eM.warn(e.join(" "));return}e$(new ec(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function e7(e,t){if(null!==e&&"function"!=typeof e)throw eY.create("invalid-log-argument");for(let r of eg){let n=null;t&&t.level&&(n=em[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:l[r].toLowerCase(),message:s,args:i,type:t.name})}}}function e9(e){eg.forEach(t=>{t.setLogLevel(e)})}let te="firebase-heartbeat-store",tt=null;function tr(){return tt||(tt=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eA(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eA(a.result),e.oldVersion,e.newVersion,eA(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(te)}catch(e){console.warn(e)}}}).catch(e=>{throw eY.create("idb-open",{originalErrorMessage:e.message})})),tt}async function tn(e){try{let t=(await tr()).transaction(te),r=await t.objectStore(te).get(ts(e));return await t.done,r}catch(e){if(e instanceof ee)eM.warn(e.message);else{let t=eY.create("idb-get",{originalErrorMessage:e?.message});eM.warn(t.message)}}}async function ti(e,t){try{let r=(await tr()).transaction(te,"readwrite"),n=r.objectStore(te);await n.put(t,ts(e)),await r.done}catch(e){if(e instanceof ee)eM.warn(e.message);else{let t=eY.create("idb-set",{originalErrorMessage:e?.message});eM.warn(t.message)}}}function ts(e){return`${e.name}!${e.options.appId}`}class ta{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tl(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=to();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eM.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=to(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tu(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tu(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=O(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eM.warn(e),""}}}function to(){return new Date().toISOString().substring(0,10)}class tl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Z()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tn(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tu(e){return O(JSON.stringify({version:2,heartbeats:e})).length}function th(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}e$(new ec("platform-logger",e=>new eO(e),"PRIVATE")),e$(new ec("heartbeat",e=>new ta(e),"PRIVATE")),e8(eP,eL,""),e8(eP,eL,"esm2020"),e8("fire-js",""),e.s(["SDK_VERSION",()=>e1,"_DEFAULT_ENTRY_NAME",()=>eF,"_addComponent",()=>eq,"_addOrOverwriteComponent",()=>ez,"_apps",()=>eU,"_clearComponents",()=>eJ,"_components",()=>ej,"_getProvider",()=>eK,"_isFirebaseApp",()=>eH,"_isFirebaseServerApp",()=>eQ,"_isFirebaseServerAppSettings",()=>eW,"_registerComponent",()=>e$,"_removeServiceInstance",()=>eG,"_serverApps",()=>eB,"deleteApp",()=>e4,"getApp",()=>e3,"getApps",()=>e5,"initializeApp",()=>e2,"initializeServerApp",()=>e6,"onLog",()=>e7,"registerVersion",()=>e8,"setLogLevel",()=>e9],60884);let tc=new et("auth","Firebase",th()),td=new e_("@firebase/auth");function tf(e,...t){td.logLevel<=l.ERROR&&td.error(`Auth (${e1}): ${e}`,...t)}function tp(e,...t){throw tv(e,...t)}function tg(e,...t){return tv(e,...t)}function tm(e,t,r){return new et("auth","Firebase",{...th(),[t]:r}).create(t,{appName:e.name})}function ty(e){return tm(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tv(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return tc.create(e,...t)}function tw(e,t,...r){if(!e)throw tv(t,...r)}function t_(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tf(t),Error(t)}function tb(){return"u">typeof self&&self.location?.href||""}function tI(){return"u">typeof self&&self.location?.protocol||null}class tE{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||t_(r),this.isMobile="u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(W())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){let e;return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tI()||"https:"===tI()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tT(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||t_(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tS{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void t_("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void t_("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void t_("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tk=new tE(3e4,6e4);function tx(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function tN(e,t,r,n,i={}){return tD(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=es({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&q(e.emulatorConfig.host)&&(l.credentials="include"),tS.fetch()(await tO(e,e.config.apiHost,r,a),l)})}async function tD(e,t,r){e._canInitEmulator=!1;let n={...tC,...t};try{let t=new tP(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw tL(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw tL(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw tL(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw tL(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw tm(e,a,r);tp(e,a)}}catch(t){if(t instanceof ee)throw t;tp(e,"network-request-failed",{message:String(t)})}}async function tR(e,t,r,n,i={}){let s=await tN(e,t,r,n,i);return"mfaPendingCredential"in s&&tp(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function tO(e,t,r,n){let i=`${t}${r}?${n}`,s=e.config.emulator?tT(e.config,i):`${e.config.apiScheme}://${i}`;return tA.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class tP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tg(this.auth,"network-request-failed")),tk.get())})}}function tL(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=tg(e,t,n);return i.customData._tokenResponse=r,i}function tM(e){return void 0!==e&&void 0!==e.enterprise}class tF{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tV(e,t){return tN(e,"GET","/v2/recaptchaConfig",tx(e,t))}async function tU(e,t){return tN(e,"POST","/v1/accounts:delete",t)}async function tB(e,t){return tN(e,"POST","/v1/accounts:lookup",t)}function tj(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tq(e,t=!1){let r=eh(e),n=await r.getIdToken(t),i=t$(n);tw(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:tj(tz(i.auth_time)),issuedAtTime:tj(tz(i.iat)),expirationTime:tj(tz(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function tz(e){return 1e3*Number(e)}function t$(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return tf("JWT malformed, contained fewer than 3 sections"),null;try{let e=P(r);if(!e)return tf("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tf("Caught error parsing JWT payload as JSON",e?.toString()),null}}function tK(e){let t=t$(e);return tw(t,"internal-error"),tw(void 0!==t.exp,"internal-error"),tw(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tG(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof ee&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tH{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tW{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tj(this.lastLoginAt),this.creationTime=tj(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tQ(e){var t,r;let n=e.auth,i=await e.getIdToken(),s=await tG(e,tB(n,{idToken:i}));tw(s?.users.length,n,"internal-error");let a=s.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?tY(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),u=e.isAnonymous,h=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new tW(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&h})}async function tJ(e){let t=eh(e);await tQ(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tY(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function tX(e,t){let r=await tD(e,{},async()=>{let r=es({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await tO(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&q(e.emulatorConfig.host)&&(o.credentials="include"),tS.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function tZ(e,t){return tN(e,"POST","/v2/accounts:revokeToken",tx(e,t))}class t0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tw(e.idToken,"internal-error"),tw(void 0!==e.idToken,"internal-error"),tw(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):tK(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tw(0!==e.length,"internal-error");let t=tK(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tw(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await tX(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new t0;return r&&(tw("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(tw("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(tw("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new t0,this.toJSON())}_performRefresh(){return t_("not implemented")}}function t1(e,t){tw("string"==typeof e||void 0===e,"internal-error",{appName:t})}class t2{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new tH(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new tW(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await tG(this,this.stsTokenManager.getToken(this.auth,e));return tw(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tq(this,e)}reload(){return tJ(this)}_assign(e){this!==e&&(tw(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new t2({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tw(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tQ(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eQ(this.auth.app))return Promise.reject(ty(this.auth));let e=await this.getIdToken();return await tG(this,tU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;tw(h&&p,e,"internal-error");let g=t0.fromJSON(this.name,p);tw("string"==typeof h,e,"internal-error"),t1(r,e.name),t1(n,e.name),tw("boolean"==typeof c,e,"internal-error"),tw("boolean"==typeof d,e,"internal-error"),t1(i,e.name),t1(s,e.name),t1(a,e.name),t1(o,e.name),t1(l,e.name),t1(u,e.name);let m=new t2({uid:h,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:l,lastLoginAt:u});return f&&Array.isArray(f)&&(m.providerData=f.map(e=>({...e}))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,r=!1){let n=new t0;n.updateFromServerResponse(t);let i=new t2({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await tQ(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];tw(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?tY(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new t0;a.updateFromIdToken(r);let o=new t2({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new tW(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let t6=new Map;function t3(e){var t,r;t="Expected a class definition",e instanceof Function||t_(t);let n=t6.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||t_(r)):(n=new e,t6.set(e,n)),n}class t5{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function t4(e,t,r){return`firebase:${e}:${t}:${r}`}t5.type="NONE";class t8{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=t4(this.userKey,n.apiKey,i),this.fullPersistenceKey=t4("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await tB(this.auth,{idToken:e}).catch(()=>void 0);return t?t2._fromGetAccountInfoResponse(this.auth,t,e):null}return t2._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new t8(t3(t5),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||t3(t5),s=t4(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await tB(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await t2._fromGetAccountInfoResponse(e,r,t)}else n=t2._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new t8(i,e,r)}}function t7(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(rr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(t9(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ri(t))return"Blackberry";if(rs(t))return"Webos";if(re(t))return"Safari";if((t.includes("chrome/")||rt(t))&&!t.includes("edge/"))return"Chrome";if(rn(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function t9(e=W()){return/firefox\//i.test(e)}function re(e=W()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function rt(e=W()){return/crios\//i.test(e)}function rr(e=W()){return/iemobile/i.test(e)}function rn(e=W()){return/android/i.test(e)}function ri(e=W()){return/blackberry/i.test(e)}function rs(e=W()){return/webos/i.test(e)}function ra(e=W()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ro(e=W()){return ra(e)||rn(e)||rs(e)||ri(e)||/windows phone/i.test(e)||rr(e)}function rl(e,t=[]){let r;switch(e){case"Browser":r=t7(W());break;case"Worker":r=`${t7(W())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${e1}/${n}`}class ru{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function rh(e,t={}){return tN(e,"GET","/v2/passwordPolicy",tx(e,t))}class rc{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class rd{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rf(this),this.idTokenSubscription=new rf(this),this.beforeStateQueue=new ru(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=t3(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await t8.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await tB(this,{idToken:e}),r=await t2._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(eQ(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(tw(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tQ(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eQ(this.app))return Promise.reject(ty(this));let t=e?eh(e):null;return t&&tw(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tw(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eQ(this.app)?Promise.reject(ty(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eQ(this.app)?Promise.reject(ty(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(t3(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new rc(await rh(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new et("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await tZ(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&t3(e)||this._popupRedirectResolver;tw(t,this,"argument-error"),this.redirectPersistenceManager=await t8.create(this,[t3(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(tw(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tw(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rl(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(eQ(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){td.logLevel<=l.WARN&&td.warn(`Auth (${e1}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class rf{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new el(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return tw(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let rp={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rg(e){return`__${e}${Math.floor(1e6*Math.random())}`}class rm{constructor(){this.enterprise=new ry}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ry{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let rv="NO_RECAPTCHA";class rw{constructor(e){this.type="recaptcha-enterprise",this.auth=eh(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{tV(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new tF(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;tM(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(rv)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new rm().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&tM(window.grecaptcha))n(r,e,i);else{var s;if("u"<typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=rp.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,rp.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function r_(e,t,r,n=!1,i=!1){let s,a=new rw(e);if(i)s=rv;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function rb(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await r_(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await r_(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await r_(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await r_(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await r_(e,t,r,!1,!0);return n(e,i)}}async function rI(e){let t=eh(e),r=new tF(await tV(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new rw(t).verify()}function rE(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rT(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class rS{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return t_("not implemented")}_getIdTokenResponse(e){return t_("not implemented")}_linkToIdToken(e,t){return t_("not implemented")}_getReauthenticationResolver(e){return t_("not implemented")}}async function rC(e,t){return tN(e,"POST","/v1/accounts:signUp",t)}async function rA(e,t){return tR(e,"POST","/v1/accounts:signInWithPassword",tx(e,t))}async function rk(e,t){return tR(e,"POST","/v1/accounts:signInWithEmailLink",tx(e,t))}async function rx(e,t){return tR(e,"POST","/v1/accounts:signInWithEmailLink",tx(e,t))}class rN extends rS{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new rN(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new rN(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return rb(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",rA,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rk(e,{email:this._email,oobCode:this._password});default:tp(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return rb(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rC,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rx(e,{idToken:t,email:this._email,oobCode:this._password});default:tp(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rD(e,t){return tR(e,"POST","/v1/accounts:signInWithIdp",tx(e,t))}class rR extends rS{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new rR(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tp("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new rR(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return rD(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,rD(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,rD(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=es(t)}return e}}async function rO(e,t){return tN(e,"POST","/v1/accounts:sendVerificationCode",tx(e,t))}async function rP(e,t){return tR(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,t))}async function rL(e,t){let r=await tR(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,t));if(r.temporaryProof)throw tL(e,"account-exists-with-different-credential",r);return r}let rM={USER_NOT_FOUND:"user-not-found"};async function rF(e,t){return tR(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,{...t,operation:"REAUTH"}),rM)}class rV extends rS{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new rV({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new rV({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return rP(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rL(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return rF(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new rV({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class rU{constructor(e){const t=ea(eo(e)),r=t.apiKey??null,n=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tw(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,r,n,i=(r=(t=ea(eo(e)).link)?ea(eo(t)).deep_link_id:null,((n=ea(eo(e)).deep_link_id)?ea(eo(n)).link:null)||n||r||t||e);try{return new rU(i)}catch{return null}}}class rB{constructor(){this.providerId=rB.PROVIDER_ID}static credential(e,t){return rN._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=rU.parseLink(t);return tw(r,"argument-error"),rN._fromEmailAndCode(e,r.code,r.tenantId)}}rB.PROVIDER_ID="password",rB.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rB.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rj{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rq extends rj{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rz extends rq{constructor(){super("facebook.com")}static credential(e){return rR._fromParams({providerId:rz.PROVIDER_ID,signInMethod:rz.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rz.credentialFromTaggedObject(e)}static credentialFromError(e){return rz.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rz.credential(e.oauthAccessToken)}catch{return null}}}rz.FACEBOOK_SIGN_IN_METHOD="facebook.com",rz.PROVIDER_ID="facebook.com";class r$ extends rq{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rR._fromParams({providerId:r$.PROVIDER_ID,signInMethod:r$.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return r$.credentialFromTaggedObject(e)}static credentialFromError(e){return r$.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return r$.credential(t,r)}catch{return null}}}r$.GOOGLE_SIGN_IN_METHOD="google.com",r$.PROVIDER_ID="google.com";class rK extends rq{constructor(){super("github.com")}static credential(e){return rR._fromParams({providerId:rK.PROVIDER_ID,signInMethod:rK.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rK.credentialFromTaggedObject(e)}static credentialFromError(e){return rK.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rK.credential(e.oauthAccessToken)}catch{return null}}}rK.GITHUB_SIGN_IN_METHOD="github.com",rK.PROVIDER_ID="github.com";class rG extends rq{constructor(){super("twitter.com")}static credential(e,t){return rR._fromParams({providerId:rG.PROVIDER_ID,signInMethod:rG.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rG.credentialFromTaggedObject(e)}static credentialFromError(e){return rG.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rG.credential(t,r)}catch{return null}}}rG.TWITTER_SIGN_IN_METHOD="twitter.com",rG.PROVIDER_ID="twitter.com";class rH{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new rH({user:await t2._fromIdTokenResponse(e,r,n),providerId:rW(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rH({user:e,providerId:rW(r),_tokenResponse:r,operationType:t})}}function rW(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rQ extends ee{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,rQ.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new rQ(e,t,r,n)}}function rJ(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw rQ._fromErrorAndOperation(e,r,t,n);throw r})}async function rY(e,t,r=!1){let n=await tG(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rH._forOperation(e,"link",n)}async function rX(e,t,r=!1){let{auth:n}=e;if(eQ(n.app))return Promise.reject(ty(n));let i="reauthenticate";try{let s=await tG(e,rJ(n,i,t,e),r);tw(s.idToken,n,"internal-error");let a=t$(s.idToken);tw(a,n,"internal-error");let{sub:o}=a;return tw(e.uid===o,n,"user-mismatch"),rH._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&tp(n,"user-mismatch"),e}}async function rZ(e,t,r=!1){if(eQ(e.app))return Promise.reject(ty(e));let n="signIn",i=await rJ(e,n,t),s=await rH._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}class r0{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?r1._fromServerResponse(e,t):"totpInfo"in t?r2._fromServerResponse(e,t):tp(e,"internal-error")}}class r1 extends r0{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new r1(t)}}class r2 extends r0{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new r2(t)}}function r6(e,t){return tN(e,"POST","/v2/accounts/mfaEnrollment:start",tx(e,t))}new WeakMap;let r3="__sak";class r5{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(r3,"1"),this.storage.removeItem(r3),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class r4 extends r5{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ro(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){let r;if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let n=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);((r=W()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}r4.type="LOCAL";class r8 extends r5{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}r8.type="SESSION";class r7{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new r7(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function r9(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}r7.receivers=[];class ne{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,s="u">typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=r9("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function nt(){return window}function nr(){return void 0!==nt().WorkerGlobalScope&&"function"==typeof nt().importScripts}async function nn(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let ni="firebaseLocalStorageDb",ns="firebaseLocalStorage",na="fbase_key";class no{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function nl(e,t){return e.transaction([ns],t?"readwrite":"readonly").objectStore(ns)}function nu(){let e=indexedDB.open(ni,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(ns,{keyPath:na})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(ns)?t(r):(r.close(),await new no(indexedDB.deleteDatabase(ni)).toPromise(),t(await nu()))})})}async function nh(e,t,r){return new no(nl(e,!0).put({[na]:t,value:r})).toPromise()}async function nc(e,t){let r=nl(e,!1).get(t),n=await new no(r).toPromise();return void 0===n?null:n.value}function nd(e,t){return new no(nl(e,!0).delete(t)).toPromise()}class nf{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await nu()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=r7._getInstance(nr()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await nn(),!this.activeServiceWorker)return;this.sender=new ne(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await nu();return await nh(e,r3,"1"),await nd(e,r3),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>nc(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nd(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new no(nl(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function np(e,t){return tN(e,"POST","/v2/accounts/mfaSignIn:start",tx(e,t))}nf.type="LOCAL",rg("rcb"),new tE(3e4,6e4);let ng="recaptcha";async function nm(e,t,r){if(!e._getRecaptchaConfig())try{await rI(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){tw("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===rv){tw(r?.type===ng,e,"argument-error");let n=await ny(e,t,r);return r6(e,n)}return r6(e,t)},a=rb(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tw("signin"===t.type,e,"internal-error");let i=n.multiFactorHint?.uid||n.multiFactorUid;tw(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===rv){tw(r?.type===ng,e,"argument-error");let n=await ny(e,t,r);return np(e,n)}return np(e,t)},o=rb(e,s,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===rv){tw(r?.type===ng,e,"argument-error");let n=await ny(e,t,r);return rO(e,n)}return rO(e,t)},s=rb(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function ny(e,t,r){tw(r.type===ng,e,"argument-error");let n=await r.verify();tw("string"==typeof n,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class nv{constructor(e){this.providerId=nv.PROVIDER_ID,this.auth=eh(e)}verifyPhoneNumber(e,t){return nm(this.auth,e,eh(t))}static credential(e,t){return rV._fromVerification(e,t)}static credentialFromResult(e){return nv.credentialFromTaggedObject(e)}static credentialFromError(e){return nv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?rV._fromTokenResponse(t,r):null}}function nw(e,t){return t?t3(t):(tw(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}nv.PROVIDER_ID="phone",nv.PHONE_SIGN_IN_METHOD="phone";class n_ extends rS{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rD(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rD(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rD(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nb(e){return rZ(e.auth,new n_(e),e.bypassAuthState)}function nI(e){let{auth:t,user:r}=e;return tw(r,t,"internal-error"),rX(r,new n_(e),e.bypassAuthState)}async function nE(e){let{auth:t,user:r}=e;return tw(r,t,"internal-error"),rY(r,new n_(e),e.bypassAuthState)}class nT{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nb;case"linkViaPopup":case"linkViaRedirect":return nE;case"reauthViaPopup":case"reauthViaRedirect":return nI;default:tp(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||t_(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||t_(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let nS=new tE(2e3,1e4);async function nC(e,t,r){if(eQ(e.app))return Promise.reject(tg(e,"operation-not-supported-in-this-environment"));let n=eh(e);if(!(t instanceof rj))throw rj.name!==t.constructor.name&&tp(e,"argument-error"),tm(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let i=nw(n,r);return new nA(n,"signInViaPopup",t,i).executeNotNull()}class nA extends nT{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,nA.currentPopupAction&&nA.currentPopupAction.cancel(),nA.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tw(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||t_(t);let r=r9();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tg(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tg(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nA.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tg(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nS.get())};e()}}nA.currentPopupAction=null;let nk=new Map;class nx extends nT{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nk.get(this.auth._key());if(!e){try{let t=await nN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nk.set(this.auth._key(),e)}return this.bypassAuthState||nk.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nN(e,t){var r;let n=t4("pendingRedirect",(r=t).config.apiKey,r.name),i=t3(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(n)==="true";return await i._remove(n),s}function nD(e,t){nk.set(e._key(),t)}async function nR(e,t,r=!1){if(eQ(e.app))return Promise.reject(ty(e));let n=eh(e),i=nw(n,t),s=new nx(n,i,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class nO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nL(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!nL(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tg(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nP(e))}saveEventToCache(e){this.cachedEventUids.add(nP(e)),this.lastProcessedEventTime=Date.now()}}function nP(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nL({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function nM(e,t={}){return tN(e,"GET","/v1/projects",t)}let nF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nV=/^https?/;async function nU(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nM(e);for(let e of t)try{if(function(e){let t=tb(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!nV.test(r))return!1;if(nF.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch{}tp(e,"unauthorized-domain")}let nB=new tE(3e4,6e4);function nj(){let e=nt().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let nq=null,nz=new tE(5e3,15e3),n$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nK=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nG(e){let t,r,n,i,s,a=await (nq=nq||new Promise((t,r)=>{function n(){nj(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nj(),r(tg(e,"network-request-failed"))},timeout:nB.get()})}if(nt().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(nt().gapi?.load)n();else{var i;let t=rg("iframefcb");return nt()[t]=()=>{gapi.load?n():r(tg(e,"network-request-failed"))},(i=`${rp.gapiScript}?onload=${t}`,rp.loadJS(i)).catch(e=>r(e))}}).catch(e=>{throw nq=null,e})),o=nt().gapi;return tw(o,e,"internal-error"),a.open({where:document.body,url:(tw((t=e.config).authDomain,e,"auth-domain-config-required"),r=t.emulator?tT(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:e1},(i=nK.get(e.config.apiHost))&&(n.eid=i),(s=e._getFrameworks()).length&&(n.fw=s.join(",")),`${r}?${es(n).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:n$,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=tg(e,"network-request-failed"),s=nt().setTimeout(()=>{n(i)},nz.get());function a(){nt().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let nH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nW{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nQ=encodeURIComponent("fac");async function nJ(e,t,r,n,i,s){tw(e.config.authDomain,e,"auth-domain-config-required"),tw(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:e1,eventId:i};if(t instanceof rj)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof rq){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${nQ}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?tT(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${es(a).slice(1)}${l}`}let nY="webStorageSupport",nX=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=r8,this._completeRedirectFn=nR,this._overrideRedirectResult=nD}async _openPopup(e,t,r,n){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||t_(s);let a=await nJ(e,t,r,tb(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l={...nH,width:n.toString(),height:i.toString(),top:s,left:a},u=W().toLowerCase();r&&(o=rt(u)?"_blank":r),t9(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=W()){return ra(e)&&!!window.navigator?.standalone}(u)&&"_self"!==o){var c,d;let e,r;return c=t||"",d=o,(e=document.createElement("a")).href=c,e.target=d,(r=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r),new nW(null)}let f=window.open(t||"",o,h);tw(f,e,"popup-blocked");try{f.focus()}catch(e){}return new nW(f)}(e,a,r9())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await nJ(e,t,r,tb(),n),nt().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||t_(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await nG(e),r=new nO(e);return t.register("authEvent",t=>(tw(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nY,{type:nY},r=>{let n=r?.[0]?.[nY];void 0!==n&&t(!!n),tp(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nU(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ro()||re()||ra()}};var nZ="@firebase/auth",n0="1.12.0";class n1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tw(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let n2=B("authIdTokenMaxAge")||300,n6=null;rp={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=tg("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},s="Browser",e$(new ec("auth",(e,{options:t})=>{let r,n,i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=i.options;tw(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});let h=new rd(i,a,o,{apiKey:l,authDomain:u,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rl(s)});return n=(Array.isArray(r=t?.persistence||[])?r:[r]).map(t3),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(n,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),e$(new ec("auth-internal",e=>new n1(eh(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),e8(nZ,n0,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(s)),e8(nZ,n0,"esm2020"),e.s([],6763),e.i(6763),e8("firebase","12.8.0","app"),e.i(60884);var n3=e.i(98949),n5="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,n4={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(l(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=o(0),d=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function _(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(g(e))return t=_(m(e),t),new w(m(t.g),m(t.h));if(g(t))return t=_(e,m(t)),new w(m(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=b(r),n=b(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=l(r)).j(t);g(a)||a.l(e)>0;)r-=n,a=(s=l(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function b(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);let t=l(Math.pow(e,6));var r=this;let n="";for(;;){let i=_(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,v(r,2*n+2*t),r[2*n+2*t+1]+=i*o,v(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,v(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,v(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,h=n4.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=l(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=l(Math.pow(r,s)),i=i.j(s).add(l(a))):i=(i=i.j(n)).add(l(a))}return i},u=n4.Integer=i}).apply(void 0!==n5?n5:"u">typeof self?self:"u">typeof window?window:{});var n8="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,n7={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n8&&n8];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function u(e,t,r){return(u=l).apply(null,arguments)}function h(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function w(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var _="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function b(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var E=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,C=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){let r=E.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},k=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(x)}};function x(){let e;for(var t;e=null,A.g&&(e=A.g,A.g=A.g.next,A.g||(A.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}E.j(t),E.h<100&&(E.h++,t.next=E.g,E.g=t)}C=!1}function N(){this.u=this.u,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function P(e,t){D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}w(P,D),P.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&P.Z.h.call(this)},P.prototype.h=function(){P.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++M,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function U(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function B(e){let t={};for(let r in e)t[r]=e[r];return t}let j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<j.length;t++)r=j[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function K(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=K(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=X(e);if(l||(e[G]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?($(r,e),0==r.h&&(r.src=null,t[G]=null)):V(e)}}}function J(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new P(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Q(e),e=r.call(n,t)}return e}function X(e){return(e=e[G])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){N.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var a=t;q(t=new D(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}w(et,N),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[L])?(t=t.i,(a=String(r).toString())in t.g&&(n=K(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=K(r,n,i,s)),(n=t>-1?r[t]:null)&&Q(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){N.call(this),this.h=e,this.g={}}w(es,N);var ea=[];function eo(e){U(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){D.call(this,"d")}function eg(){D.call(this,"c")}w(ep,D),w(eg,D);var em={},ey=null;function ev(){return ey=ey||new et}function ew(e){D.call(this,em.Ia,e)}function e_(e){let t=ev();er(t,new ew(t))}function eb(e,t){D.call(this,em.STAT_EVENT,e),this.stat=t}function eI(e){let t=ev();er(t,new eb(t,e))}function eE(e,t){D.call(this,em.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function eC(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}em.Ia="serverreachability",w(ew,D),em.STAT_EVENT="statevent",w(eb,D),em.Ja="timingevent",w(eE,D),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eA={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ek={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ex(){}function eN(e){return encodeURIComponent(String(e))}function eD(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}w(ex,ec),ex.prototype.g=function(){return new XMLHttpRequest},e=new ex;var eO={},eP={};function eL(e,t,r){e.M=1,e.A=e5(e0(t)),e.u=r,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,h=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),tu(h.i,"t",c),e.C=0,h=e.j.L,e.h=new eR,e.g=tQ(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(u(e.Y,e,e.g),e.P)),t=e.V,h=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.K(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.J(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!1,i,s)}(h,d[e],c||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?B(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),e_(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eU(e,e.H)}function eU(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(u(e.aa,e),t)}function eB(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function ej(e){0==e.j.I||e.K||t$(e.j,e)}function eq(e){eB(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eW(r.h,e))){if(!e.L&&eW(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tz(r),tO(r);else break e;tB(r),eI(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(u(r.Va,r),6e3));1>=eH(r.h)&&r.ta&&(r.ta=void 0)}else tG(r,11)}else if((e.L||r.g==e)&&tz(r),!O(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e3(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tW(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eB(e),eV(e)),n.g=e}else tU(n);r.i.length>0&&tL(r)}else"stop"!=o[0]&&"close"!=o[0]||tG(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tG(r,7):tR(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}e_(4)}catch(e){}}eD.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tk(e)?t.j():this.Y(e)},eD.prototype.Y=function(e){try{if(e==this.g)e:{let f=tk(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tx(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?e_(3):e_(2)),eB(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tx(e.g);if(""===t)return"";let r="",n=t.length,i=4==tk(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eq(e),ej(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(u)){var c=u;break t}}c=null}if(e=c)eC(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eI(12),eq(this),ej(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eP:isNaN(r=Number(t.substring(r,n)))?eO:(n+=1)+r>t.length?eP:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eP){4==f&&(this.m=4,eI(14),e=!1),eC(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,eI(15),eC(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eC(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tj(d),d.P=!0,eI(11))}}else eC(this.i,this.l,r,"[Invalid Chunked Response]"),eq(this),ej(this)}else eC(this.i,this.l,r,null),ez(this,r);4==f&&eq(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tk(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(O(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),eq(this),ej(this)}}}catch(e){}finally{}},eD.prototype.cancel=function(){this.K=!0,eq(this)},eD.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(e_(),eI(17)),eq(this),this.m=2,ej(this)):eU(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eK(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eG(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return b(e.i)}eK.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e8(t,tr)),e.i=new ti(t,e.l))}function e3(e,t,r){e.i.set(t,r)}function e5(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e6(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),b(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tg(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tw(e){let t="";return U(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function t_(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tw(r),"string"==typeof e?null!=r&&eN(r):e3(e,t,r))}function tb(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eN(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eN(r[t])),e.push(n)}}return this.i=e.join("&")},w(tp,ec),tp.prototype.g=function(){return new tg(this.i,this.h)},w(tg,et),(t=tg.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),w(tb,et);var tI=/^https?$/i,tE=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tA(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tC(e){if(e.h&&void 0!==s){if(e.v&&4==tk(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tk(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tI.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tk(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tS(e)}}finally{tA(e)}}}}function tA(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tk(e){return e.g?e.g.readyState:0}function tx(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tN(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tD(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tN("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tN("baseRetryDelayMs",5e3,e),this.Za=tN("retryDelaySeedMs",1e4,e),this.Ta=tN("forwardChannelMaxRetries",2,e),this.va=tN("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eK(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tR(e){if(tP(e),3==e.I){var t=e.V++,r=e0(e.J);if(e3(r,"SID",e.M),e3(r,"RID",t),e3(r,"TYPE","terminate"),tF(e,r),(t=new eD(e,e.j,t)).M=2,t.A=e5(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tH(e)}function tO(e){e.g&&(tj(e),e.g.cancel(),e.g=null)}function tP(e){tO(e),e.v&&(a.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tL(e){if(!eG(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||k(),C||(S(),C=!0),A.add(t,e),e.D=0}}function tM(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e3(n,"SID",e.M),e3(n,"RID",r),e3(n,"AID",e.K),tF(e,n),e.u&&e.o&&t_(n,e.u,e.o),r=new eD(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tV(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,r),eL(r,n,t)}function tF(e,t){e.H&&U(e.H,function(e,r){e3(t,r,e)}),e.l&&U({},function(e,r){e3(t,r,e)})}function tV(e,t,r){r=Math.min(e.i.length,r);let n=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tU(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||k(),C||(S(),C=!0),A.add(t,e),e.A=0}}function tB(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(u(e.Da,e),tK(e,e.A)),e.A++,!0)}function tj(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tq(e){e.g=new eD(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&t_(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e5(e0(t)),r.u=null,r.R=!0,eM(r,e)}function tz(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function t$(e,t){var r,n=null;if(e.g==t){tz(e),tj(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;n=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ev(),new eE(i,n)),tL(e)}else tU(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(u(e.Ea,e,r),tK(e,e.D)),e.D++,!0)))||2==i&&tB(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tG(e,5);break;case 4:tG(e,10);break;case 3:tG(e,6);break;default:tG(e,2)}}}function tK(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tG(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=u(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e5(i),l?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=h(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=h(td,r,"TestLoadImage: error",!1,t,n),n.onabort=h(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=h(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eS,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tH(e),tP(e)}function tH(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,b(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e3(n,r,t),e3(n,"VER",e.ka),tF(e,n),n}function tQ(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tb(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tJ(){}function tY(){}function tX(e,t){et.call(this),this.g=new tD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){eg.call(this),this.status=1}function t1(e){this.g=e}(t=tb.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=_(u(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tE,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tA(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tA(this,!0)),tb.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tC(this):this.Xa())},t.Xa=function(){tC(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tk(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tD.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eI(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tW(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eD(this,this.j,e),s=this.o;if(this.U&&(s?q(s=B(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tV(this,i,t),e3(r=e0(this.J),"RID",e),e3(r,"CVER",22),this.G&&e3(r,"X-HTTP-Session-Id",this.G),tF(this,r),s&&(this.R?t="headers="+eN(tw(s))+"&"+t:this.u&&t_(r,this.u,s)),eQ(this.h,i),this.Ra&&e3(r,"TYPE","init"),this.S?(e3(r,"$req",t),e3(r,"SID","null"),i.U=!0,eL(i,r,null)):eL(i,r,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eG(this.h)||tM(this))},t.Da=function(){if(this.v=null,tq(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tO(this),tq(this))},t.Va=function(){null!=this.C&&(this.C=null,tO(this),tB(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tY.prototype.g=function(e,t){return new tX(e,t)},w(tX,et),tX.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tX.prototype.close=function(){tR(this.g)},tX.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},tX.prototype.N=function(){this.g.l=null,delete this.j,tR(this.g),delete this.g,tX.Z.N.call(this)},w(tZ,ep),w(t0,eg),w(t1,tJ),t1.prototype.ra=function(){er(this.g,"a")},t1.prototype.qa=function(e){er(this.g,new tZ(e))},t1.prototype.pa=function(e){er(this.g,new t0)},t1.prototype.oa=function(){er(this.g,"b")},tY.prototype.createWebChannel=tY.prototype.g,tX.prototype.send=tX.prototype.o,tX.prototype.open=tX.prototype.m,tX.prototype.close=tX.prototype.close,v=n7.createWebChannelTransport=function(){return new tY},y=n7.getStatEventTarget=function(){return ev()},m=n7.Event=em,g=n7.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eA.NO_ERROR=0,eA.TIMEOUT=8,eA.HTTP_ERROR=6,p=n7.ErrorCode=eA,ek.COMPLETE="complete",f=n7.EventType=ek,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,d=n7.WebChannel=ed,n7.FetchXmlHttpFactory=tp,tb.prototype.listenOnce=tb.prototype.K,tb.prototype.getLastError=tb.prototype.Ha,tb.prototype.getLastErrorCode=tb.prototype.ya,tb.prototype.getStatus=tb.prototype.ca,tb.prototype.getResponseJson=tb.prototype.La,tb.prototype.getResponseText=tb.prototype.la,tb.prototype.send=tb.prototype.ea,tb.prototype.setWithCredentials=tb.prototype.Fa,c=n7.XhrIo=tb}).apply(void 0!==n8?n8:"u">typeof self?self:"u">typeof window?window:{});class n9{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n9.UNAUTHENTICATED=new n9(null),n9.GOOGLE_CREDENTIALS=new n9("google-credentials-uid"),n9.FIRST_PARTY=new n9("first-party-uid"),n9.MOCK_USER=new n9("mock-user");let ie="12.8.0",it=new e_("@firebase/firestore");function ir(){return it.logLevel}function ii(e,...t){if(it.logLevel<=l.DEBUG){let r=t.map(io);it.debug(`Firestore (${ie}): ${e}`,...r)}}function is(e,...t){if(it.logLevel<=l.ERROR){let r=t.map(io);it.error(`Firestore (${ie}): ${e}`,...r)}}function ia(e,...t){if(it.logLevel<=l.WARN){let r=t.map(io);it.warn(`Firestore (${ie}): ${e}`,...r)}}function io(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function il(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,iu(e,n,r)}function iu(e,t,r){let n=`FIRESTORE (${ie}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw is(n),Error(n)}function ih(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||iu(t,i,n)}let ic={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class id extends ee{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ip{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ig{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class im{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n9.UNAUTHENTICATED))}shutdown(){}}class iy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class iv{constructor(e){this.t=e,this.currentUser=n9.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ih(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new ip;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ip,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{ii("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(ii("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ip)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ii("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ih("string"==typeof t.accessToken,31837,{l:t}),new ig(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ih(null===e||"string"==typeof e,2055,{h:e}),new n9(e)}}class iw{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=n9.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class i_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new iw(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(n9.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ib{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iI{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eQ(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ih(void 0===this.o,3512);let r=e=>{null!=e.error&&ii("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,ii("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{ii("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):ii("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ib(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ih("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new ib(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class iE{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function iT(e,t){return e<t?-1:+(e>t)}function iS(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return iC(r)===iC(i)?iT(r,i):iC(r)?1:-1}return iT(e.length,t.length)}function iC(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function iA(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let ik="__name__";class ix{constructor(e,t,r){void 0===t?t=0:t>e.length&&il(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&il(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ix.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ix?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=ix.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return iT(e.length,t.length)}static compareSegments(e,t){let r=ix.isNumericId(e),n=ix.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ix.extractNumericId(e).compare(ix.extractNumericId(t)):iS(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return u.fromString(e.substring(4,e.length-2))}}class iN extends ix{construct(e,t,r){return new iN(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new id(ic.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new iN(t)}static emptyPath(){return new iN([])}}let iD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class iR extends ix{construct(e,t,r){return new iR(e,t,r)}static isValidIdentifier(e){return iD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),iR.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ik}static keyField(){return new iR([ik])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new id(ic.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new id(ic.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new id(ic.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new id(ic.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new iR(t)}static emptyPath(){return new iR([])}}class iO{constructor(e){this.path=e}static fromPath(e){return new iO(iN.fromString(e))}static fromName(e){return new iO(iN.fromString(e).popFirst(5))}static empty(){return new iO(iN.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===iN.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return iN.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new iO(new iN(e.slice()))}}function iP(e){if(!iO.isDocumentKey(e))throw new id(ic.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function iL(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function iM(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":il(12329,{type:typeof e})}function iF(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new id(ic.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=iM(e);throw new id(ic.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function iV(e,t){if(t<=0)throw new id(ic.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function iU(e,t){let r={typeString:e};return t&&(r.value=t),r}function iB(e,t){let r;if(!iL(e))throw new id(ic.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new id(ic.INVALID_ARGUMENT,r);return!0}class ij{static now(){return ij.fromMillis(Date.now())}static fromDate(e){return ij.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new ij(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new id(ic.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new id(ic.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?iT(this.nanoseconds,e.nanoseconds):iT(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ij._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(iB(e,ij._jsonSchema))return new ij(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ij._jsonSchemaVersion="firestore/timestamp/1.0",ij._jsonSchema={type:iU("string",ij._jsonSchemaVersion),seconds:iU("number"),nanoseconds:iU("number")};class iq{static fromTimestamp(e){return new iq(e)}static min(){return new iq(new ij(0,0))}static max(){return new iq(new ij(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class iz{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function i$(e){return e.fields.find(e=>2===e.kind)}function iK(e){return e.fields.filter(e=>2!==e.kind)}function iG(e,t){let r=iT(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=iR.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:iT(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return iT(e.fields.length,t.fields.length)}iz.UNKNOWN_ID=-1;class iH{constructor(e,t){this.fieldPath=e,this.kind=t}}class iW{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new iW(0,iY.min())}}function iQ(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new iY(iq.fromTimestamp(1e9===n?new ij(r+1,0):new ij(r,n)),iO.empty(),t)}function iJ(e){return new iY(e.readTime,e.key,-1)}class iY{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new iY(iq.min(),iO.empty(),-1)}static max(){return new iY(iq.max(),iO.empty(),-1)}}function iX(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=iO.comparator(e.documentKey,t.documentKey))?r:iT(e.largestBatchId,t.largestBatchId)}let iZ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class i0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function i1(e){if(e.code!==ic.FAILED_PRECONDITION||e.message!==iZ)throw e;ii("LocalStore","Unexpectedly lost primary lease")}class i2{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&il(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i2((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i2?t:i2.resolve(t)}catch(e){return i2.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i2.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i2.reject(t)}static resolve(e){return new i2((t,r)=>{t(e)})}static reject(e){return new i2((t,r)=>{r(e)})}static waitFor(e){return new i2((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=i2.resolve(!1);for(let r of e)t=t.next(e=>e?i2.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new i2((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new i2((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let i6="SimpleDb";class i3{static open(e,t,r,n){try{return new i3(t,e.transaction(n,r))}catch(e){throw new i7(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ip,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new i7(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=sn(t.target.error);this.S.reject(new i7(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ii(i6,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new se(this.transaction.objectStore(e))}}class i5{static delete(e){return ii(i6,"Removing database:",e),st(L().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Z())return!1;if(i5.F())return!0;let e=W(),t=i5.M(e),r=i4(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==A.default&&"YES"===A.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===i5.M(W())&&is("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ii(i6,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new i7(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new id(ic.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new id(ic.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new i7(e,n))},n.onupgradeneeded=e=>{ii(i6,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{ii(i6,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=i3.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),i2.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(ii(i6,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function i4(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class i8{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return st(this.U.delete())}}class i7 extends id{constructor(e,t){super(ic.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function i9(e){return"IndexedDbTransactionError"===e.name}class se{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(ii(i6,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(ii(i6,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),st(r)}add(e){return ii(i6,"ADD",this.store.name,e,e),st(this.store.add(e))}get(e){return st(this.store.get(e)).next(t=>(void 0===t&&(t=null),ii(i6,"GET",this.store.name,e,t),t))}delete(e){return ii(i6,"DELETE",this.store.name,e),st(this.store.delete(e))}count(){return ii(i6,"COUNT",this.store.name),st(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new i2((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new i2((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){ii(i6,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new i2((r,n)=>{t.onerror=e=>{n(sn(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new i2((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new i8(i),a=t(i.primaryKey,i.value,s);if(a instanceof i2){let e=a.catch(e=>(s.done(),i2.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>i2.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function st(e){return new i2((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(sn(e.target.error))}})}let sr=!1;function sn(e){let t=i5.M(W());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new id("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sr||(sr=!0,setTimeout(()=>{throw e},0)),e}}return e}let si="IndexBackfiller";class ss{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){ii(si,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();ii(si,`Documents written: ${e}`)}catch(e){i9(e)?ii(si,"Ignoring IndexedDB error during index backfill: ",e):await i1(e)}await this.re(6e4)})}}class sa{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return i2.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return ii(si,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(ii(si,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=iJ(t);iX(n,r)>0&&(r=n)}),new iY(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class so{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function sl(e){return null==e}function su(e){return 0===e&&1/e==-1/0}function sh(e){return"number"==typeof e&&Number.isInteger(e)&&!su(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function sc(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}so.ce=-1;function sd(e){let t=e.length;if(ih(t>=2,64408,{path:e}),2===t)return ih("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),iN.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&il(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:il(61167,{path:e})}s=t+2}return new iN(n)}let sf="remoteDocuments",sp="owner",sg="owner",sm="mutationQueues",sy="mutations",sv="batchId",sw="userMutationsIndex",s_=["userId","batchId"],sb={},sI="documentMutations",sE="remoteDocumentsV14",sT=["prefixPath","collectionGroup","readTime","documentId"],sS="documentKeyIndex",sC=["prefixPath","collectionGroup","documentId"],sA="collectionGroupIndex",sk=["collectionGroup","readTime","prefixPath","documentId"],sx="remoteDocumentGlobal",sN="remoteDocumentGlobalKey",sD="targets",sR="queryTargetsIndex",sO=["canonicalId","targetId"],sP="targetDocuments",sL=["targetId","path"],sM="documentTargetsIndex",sF=["path","targetId"],sV="targetGlobalKey",sU="targetGlobal",sB="collectionParents",sj=["collectionId","parent"],sq="clientMetadata",sz="bundles",s$="namedQueries",sK="indexConfiguration",sG="collectionGroupIndex",sH="indexState",sW=["indexId","uid"],sQ="sequenceNumberIndex",sJ=["uid","sequenceNumber"],sY="indexEntries",sX=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sZ="documentKeyIndex",s0=["indexId","uid","orderedDocumentKey"],s1="documentOverlays",s2=["userId","collectionPath","documentId"],s6="collectionPathOverlayIndex",s3=["userId","collectionPath","largestBatchId"],s5="collectionGroupOverlayIndex",s4=["userId","collectionGroup","largestBatchId"],s8="globals",s7=[sm,sy,sI,sf,sD,sp,sU,sP,sq,sx,sB,sz,s$],s9=[...s7,s1],ae=[sm,sy,sI,sE,sD,sp,sU,sP,sq,sx,sB,sz,s$,s1],at=[...ae,sK,sH,sY],ar=[...at,s8];class an extends i0{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function ai(e,t){return i5.O(e.le,t)}function as(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function aa(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function ao(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class al{constructor(e,t){this.comparator=e,this.root=t||ah.EMPTY}insert(e,t){return new al(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ah.BLACK,null,null))}remove(e){return new al(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ah.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new au(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new au(this.root,e,this.comparator,!1)}getReverseIterator(){return new au(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new au(this.root,e,this.comparator,!0)}}class au{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ah{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:ah.RED,this.left=null!=n?n:ah.EMPTY,this.right=null!=i?i:ah.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new ah(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return ah.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return ah.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,ah.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,ah.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw il(43730,{key:this.key,value:this.value});if(this.right.isRed())throw il(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw il(27949);return e+ +!this.isRed()}}ah.EMPTY=null,ah.RED=!0,ah.BLACK=!1,ah.EMPTY=new class{constructor(){this.size=0}get key(){throw il(57766)}get value(){throw il(16141)}get color(){throw il(16727)}get left(){throw il(29726)}get right(){throw il(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new ah(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ac{constructor(e){this.comparator=e,this.data=new al(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ad(this.data.getIterator())}getIteratorFrom(e){return new ad(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ac)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new ac(this.comparator);return t.data=e,t}}class ad{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function af(e){return e.hasNext()?e.getNext():void 0}class ap{constructor(e){this.fields=e,e.sort(iR.comparator)}static empty(){return new ap([])}unionWith(e){let t=new ac(iR.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new ap(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return iA(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ag extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class am{constructor(e){this.binaryString=e}static fromBase64String(e){return new am(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new ag("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new am(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return iT(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}am.EMPTY_BYTE_STRING=new am("");let ay=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function av(e){if(ih(!!e,39018),"string"==typeof e){let t=0,r=ay.exec(e);if(ih(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:aw(e.seconds),nanos:aw(e.nanos)}}function aw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function a_(e){return"string"==typeof e?am.fromBase64String(e):am.fromUint8Array(e)}let ab="server_timestamp",aI="__type__",aE="__previous_value__",aT="__local_write_time__";function aS(e){return(e?.mapValue?.fields||{})[aI]?.stringValue===ab}function aC(e){let t=e.mapValue.fields[aE];return aS(t)?aC(t):t}function aA(e){let t=av(e.mapValue.fields[aT].timestampValue);return new ij(t.seconds,t.nanos)}class ak{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let ax="(default)";class aN{constructor(e,t){this.projectId=e,this.database=t||ax}static empty(){return new aN("","")}get isDefaultDatabase(){return this.database===ax}isEqual(e){return e instanceof aN&&e.projectId===this.projectId&&e.database===this.database}}let aD="__type__",aR="__max__",aO={mapValue:{fields:{__type__:{stringValue:aR}}}},aP="__vector__",aL="value",aM={nullValue:"NULL_VALUE"};function aF(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?aS(e)?4:aX(e)?0x1fffffffffffff:aJ(e)?10:11:il(28295,{value:e})}function aV(e,t){if(e===t)return!0;let r=aF(e);if(r!==aF(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return aA(e).isEqual(aA(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=av(e.timestampValue),i=av(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return a_(e.bytesValue).isEqual(a_(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return aw(e.geoPointValue.latitude)===aw(t.geoPointValue.latitude)&&aw(e.geoPointValue.longitude)===aw(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return aw(e.integerValue)===aw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=aw(e.doubleValue),n=aw(t.doubleValue);return r===n?su(r)===su(n):isNaN(r)&&isNaN(n)}return!1;case 9:return iA(e.arrayValue.values||[],t.arrayValue.values||[],aV);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(as(s)!==as(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!aV(s[e],a[e])))return!1;return!0;default:return il(52216,{left:e})}}function aU(e,t){return void 0!==(e.values||[]).find(e=>aV(e,t))}function aB(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=aF(e),u=aF(t);if(l!==u)return iT(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return iT(e.booleanValue,t.booleanValue);case 2:let h,c;return h=aw(e.integerValue||e.doubleValue),h<(c=aw(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return aj(e.timestampValue,t.timestampValue);case 4:return aj(aA(e),aA(t));case 5:return iS(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=a_(r),f=a_(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=iT(r[e],n[e]);if(0!==t)return t}return iT(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=iT(aw(i.latitude),aw(s.latitude)))?p:iT(aw(i.longitude),aw(s.longitude));case 9:return aq(e.arrayValue,t.arrayValue);case 10:let g,m,y,v,w;return a=e.mapValue,o=t.mapValue,g=a.fields||{},m=o.fields||{},y=g[aL]?.arrayValue,v=m[aL]?.arrayValue,0!==(w=iT(y?.values?.length||0,v?.values?.length||0))?w:aq(y,v);case 11:return function(e,t){if(e===aO.mapValue&&t===aO.mapValue)return 0;if(e===aO.mapValue)return 1;if(t===aO.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=iS(n[e],s[e]);if(0!==t)return t;let a=aB(r[n[e]],i[s[e]]);if(0!==a)return a}return iT(n.length,s.length)}(e.mapValue,t.mapValue);default:throw il(23264,{he:l})}}function aj(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return iT(e,t);let r=av(e),n=av(t),i=iT(r.seconds,n.seconds);return 0!==i?i:iT(r.nanos,n.nanos)}function aq(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=aB(r[e],n[e]);if(t)return t}return iT(r.length,n.length)}function az(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=av(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?a_(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,iO.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=az(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${az(e.fields[i])}`;return r+"}"}(e.mapValue):il(61005,{value:e})}function a$(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function aK(e){return!!e&&"integerValue"in e}function aG(e){return!!e&&"arrayValue"in e}function aH(e){return!!e&&"nullValue"in e}function aW(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aQ(e){return!!e&&"mapValue"in e}function aJ(e){return(e?.mapValue?.fields||{})[aD]?.stringValue===aP}function aY(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return aa(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=aY(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=aY(e.arrayValue.values[r]);return t}return{...e}}function aX(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===aR}let aZ={mapValue:{fields:{[aD]:{stringValue:aP},[aL]:{arrayValue:{}}}}};function a0(e,t){let r=aB(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function a1(e,t){let r=aB(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class a2{constructor(e){this.value=e}static empty(){return new a2({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!aQ(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aY(t)}setAll(e){let t=iR.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=aY(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());aQ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return aV(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];aQ(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(aa(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new a2(aY(this.value))}}class a6{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new a6(e,0,iq.min(),iq.min(),iq.min(),a2.empty(),0)}static newFoundDocument(e,t,r,n){return new a6(e,1,t,iq.min(),r,n,0)}static newNoDocument(e,t){return new a6(e,2,t,iq.min(),iq.min(),a2.empty(),0)}static newUnknownDocument(e,t){return new a6(e,3,t,iq.min(),iq.min(),a2.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(iq.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=a2.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=a2.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=iq.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof a6&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new a6(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class a3{constructor(e,t){this.position=e,this.inclusive=t}}function a5(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?iO.comparator(iO.fromName(a.referenceValue),r.key):aB(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function a4(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!aV(e.position[r],t.position[r]))return!1;return!0}class a8{constructor(e,t="asc"){this.field=e,this.dir=t}}class a7{}class a9 extends a7{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new oa(e,t,r):"array-contains"===t?new oh(e,r):"in"===t?new oc(e,r):"not-in"===t?new od(e,r):"array-contains-any"===t?new of(e,r):new a9(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new oo(e,r):new ol(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(aB(t,this.value)):null!==t&&aF(this.value)===aF(t)&&this.matchesComparison(aB(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return il(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oe extends a7{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new oe(e,t)}matches(e){return ot(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ot(e){return"and"===e.op}function or(e){return"or"===e.op}function on(e){return oi(e)&&ot(e)}function oi(e){for(let t of e.filters)if(t instanceof oe)return!1;return!0}function os(e,t){let r=e.filters.concat(t);return oe.create(r,e.op)}class oa extends a9{constructor(e,t,r){super(e,t,r),this.key=iO.fromName(r.referenceValue)}matches(e){let t=iO.comparator(e.key,this.key);return this.matchesComparison(t)}}class oo extends a9{constructor(e,t){super(e,"in",t),this.keys=ou("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ol extends a9{constructor(e,t){super(e,"not-in",t),this.keys=ou("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ou(e,t){return(t.arrayValue?.values||[]).map(e=>iO.fromName(e.referenceValue))}class oh extends a9{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return aG(t)&&aU(t.arrayValue,this.value)}}class oc extends a9{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&aU(this.value.arrayValue,t)}}class od extends a9{constructor(e,t){super(e,"not-in",t)}matches(e){if(aU(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!aU(this.value.arrayValue,t)}}class of extends a9{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!aG(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>aU(this.value.arrayValue,e))}}class op{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function og(e,t=null,r=[],n=[],i=null,s=null,a=null){return new op(e,t,r,n,i,s,a)}function om(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof a9)return t.field.canonicalString()+t.op.toString()+az(t.value);if(on(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),sl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>az(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>az(e)).join(",")),e.Te=t}return e.Te}function oy(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof a9?r instanceof a9&&t.op===r.op&&t.field.isEqual(r.field)&&aV(t.value,r.value):t instanceof oe?r instanceof oe&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void il(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!a4(e.startAt,t.startAt)&&a4(e.endAt,t.endAt)}function ov(e){return iO.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ow(e,t){return e.filters.filter(e=>e instanceof a9&&e.field.isEqual(t))}function o_(e,t,r){let n=aM,i=!0;for(let r of ow(e,t)){let e=aM,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?aM:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?a$(aN.empty(),iO.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?aJ(s)?aZ:{mapValue:{}}:il(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=aM}0>a0({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>a0({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ob(e,t,r){let n=aO,i=!0;for(let r of ow(e,t)){let e=aO,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?a$(aN.empty(),iO.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?aZ:"mapValue"in s?aJ(s)?{mapValue:{}}:aO:il(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=aO}a1({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];a1({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class oI{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function oE(e){return new oI(e)}function oT(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oS(e){return null!==e.collectionGroup}function oC(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new ac(iR.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new a8(t,n))}),r.has(iR.keyField().canonicalString())||e.Ie.push(new a8(iR.keyField(),n))}return e.Ie}function oA(e){return e.Ee||(e.Ee=ok(e,oC(e))),e.Ee}function ok(e,t){if("F"===e.limitType)return og(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new a8(e.field,t)});let r=e.endAt?new a3(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new a3(e.startAt.position,e.startAt.inclusive):null;return og(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function ox(e,t){let r=e.filters.concat([t]);return new oI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function oN(e,t,r){return new oI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function oD(e,t){return oy(oA(e),oA(t))&&e.limitType===t.limitType}function oR(e){return`${om(oA(e))}|lt:${e.limitType}`}function oO(e){var t;let r;return`Query(target=${r=(t=oA(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof a9?`${t.field.canonicalString()} ${t.op} ${az(t.value)}`:t instanceof oe?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),sl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>az(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>az(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function oP(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):iO.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of oC(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=a5(i,oC(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=a5(s,oC(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function oL(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oM(e){return(t,r)=>{let n=!1;for(let i of oC(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?iO.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?aB(i,s):il(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return il(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class oF{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){aa(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return ao(this.inner)}size(){return this.innerSize}}let oV=new al(iO.comparator),oU=new al(iO.comparator);function oB(...e){let t=oU;for(let r of e)t=t.insert(r.key,r);return t}function oj(e){let t=oU;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function oq(){return new oF(e=>e.toString(),(e,t)=>e.isEqual(t))}let oz=new al(iO.comparator),o$=new ac(iO.comparator);function oK(...e){let t=o$;for(let r of e)t=t.add(r);return t}let oG=new ac(iT);function oH(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:su(t)?"-0":t}}function oW(e){return{integerValue:""+e}}class oQ{constructor(){this._=void 0}}function oJ(e,t){return e instanceof o2?aK(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class oY extends oQ{}class oX extends oQ{constructor(e){super(),this.elements=e}}function oZ(e,t){let r=o3(t);for(let t of e.elements)r.some(e=>aV(e,t))||r.push(t);return{arrayValue:{values:r}}}class o0 extends oQ{constructor(e){super(),this.elements=e}}function o1(e,t){let r=o3(t);for(let t of e.elements)r=r.filter(e=>!aV(e,t));return{arrayValue:{values:r}}}class o2 extends oQ{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function o6(e){return aw(e.integerValue||e.doubleValue)}function o3(e){return aG(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class o5{constructor(e,t){this.field=e,this.transform=t}}class o4{constructor(e,t){this.version=e,this.transformResults=t}}class o8{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new o8}static exists(e){return new o8(void 0,e)}static updateTime(e){return new o8(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function o7(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class o9{}function le(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ll(e.key,o8.none()):new ln(e.key,e.data,o8.none());{let r=e.data,n=a2.empty(),i=new ac(iR.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new li(e.key,n,new ap(i.toArray()),o8.none())}}function lt(e,t,r,n){return e instanceof ln?function(e,t,r,n){if(!o7(e.precondition,t))return r;let i=e.value.clone(),s=lo(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof li?function(e,t,r,n){if(!o7(e.precondition,t))return r;let i=lo(e.fieldTransforms,n,t),s=t.data;return(s.setAll(ls(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):o7(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function lr(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&iA(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof oX&&n instanceof oX||r instanceof o0&&n instanceof o0?iA(r.elements,n.elements,aV):r instanceof o2&&n instanceof o2?aV(r.Ae,n.Ae):r instanceof oY&&n instanceof oY)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ln extends o9{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class li extends o9{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ls(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function la(e,t,r){let n=new Map;ih(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof oX?oZ(o,l):o instanceof o0?o1(o,l):i))}return n}function lo(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof oY?(n=t,i={fields:{[aI]:{stringValue:ab},[aT]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&aS(n)&&(n=aC(n)),n&&(i.fields[aE]=n),{mapValue:i}):e instanceof oX?oZ(e,t):e instanceof o0?o1(e,t):(a=o6(s=oJ(e,t))+o6(e.Ae),aK(s)&&aK(e.Ae)?oW(a):oH(e.serializer,a))}(e,s,t))}return n}class ll extends o9{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lu extends o9{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lh{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof ln?(n=e.value.clone(),i=la(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof li?function(e,t,r){if(!o7(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=la(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(ls(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=lt(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=lt(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oq();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=le(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(iq.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oK())}isEqual(e){return this.batchId===e.batchId&&iA(this.mutations,e.mutations,(e,t)=>lr(e,t))&&iA(this.baseMutations,e.baseMutations,(e,t)=>lr(e,t))}}class lc{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){ih(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=oz,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new lc(e,t,r,n)}}class ld{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lf{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class lp{constructor(e,t){this.count=e,this.unchangedNames=t}}function lg(e){switch(e){case ic.OK:return il(64938);case ic.CANCELLED:case ic.UNKNOWN:case ic.DEADLINE_EXCEEDED:case ic.RESOURCE_EXHAUSTED:case ic.INTERNAL:case ic.UNAVAILABLE:case ic.UNAUTHENTICATED:return!1;case ic.INVALID_ARGUMENT:case ic.NOT_FOUND:case ic.ALREADY_EXISTS:case ic.PERMISSION_DENIED:case ic.FAILED_PRECONDITION:case ic.ABORTED:case ic.OUT_OF_RANGE:case ic.UNIMPLEMENTED:case ic.DATA_LOSS:return!0;default:return il(15467,{code:e})}}function lm(e){if(void 0===e)return is("GRPC error has no .code"),ic.UNKNOWN;switch(e){case w.OK:return ic.OK;case w.CANCELLED:return ic.CANCELLED;case w.UNKNOWN:return ic.UNKNOWN;case w.DEADLINE_EXCEEDED:return ic.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return ic.RESOURCE_EXHAUSTED;case w.INTERNAL:return ic.INTERNAL;case w.UNAVAILABLE:return ic.UNAVAILABLE;case w.UNAUTHENTICATED:return ic.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return ic.INVALID_ARGUMENT;case w.NOT_FOUND:return ic.NOT_FOUND;case w.ALREADY_EXISTS:return ic.ALREADY_EXISTS;case w.PERMISSION_DENIED:return ic.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return ic.FAILED_PRECONDITION;case w.ABORTED:return ic.ABORTED;case w.OUT_OF_RANGE:return ic.OUT_OF_RANGE;case w.UNIMPLEMENTED:return ic.UNIMPLEMENTED;case w.DATA_LOSS:return ic.DATA_LOSS;default:return il(39323,{code:e})}}(_=w||(w={}))[_.OK=0]="OK",_[_.CANCELLED=1]="CANCELLED",_[_.UNKNOWN=2]="UNKNOWN",_[_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_[_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_[_.NOT_FOUND=5]="NOT_FOUND",_[_.ALREADY_EXISTS=6]="ALREADY_EXISTS",_[_.PERMISSION_DENIED=7]="PERMISSION_DENIED",_[_.UNAUTHENTICATED=16]="UNAUTHENTICATED",_[_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_[_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_[_.ABORTED=10]="ABORTED",_[_.OUT_OF_RANGE=11]="OUT_OF_RANGE",_[_.UNIMPLEMENTED=12]="UNIMPLEMENTED",_[_.INTERNAL=13]="INTERNAL",_[_.UNAVAILABLE=14]="UNAVAILABLE",_[_.DATA_LOSS=15]="DATA_LOSS";let ly=null;function lv(){return new TextEncoder}let lw=new u([0xffffffff,0xffffffff],0);function l_(e){let t=lv().encode(e),r=new h;return r.update(t),new Uint8Array(r.digest())}function lb(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new u([r,n],0),new u([i,s],0)]}class lI{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lE(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lE(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lE(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=u.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(u.fromNumber(r)));return 1===n.compare(lw)&&(n=new u([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=lb(l_(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new lI(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=lb(l_(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class lE extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lT{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lS.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lT(iq.min(),n,new al(iT),oV,oK())}}class lS{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lS(r,t,oK(),oK(),oK())}}class lC{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class lA{constructor(e,t){this.targetId=e,this.Ce=t}}class lk{constructor(e,t,r=am.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class lx{constructor(){this.ve=0,this.Fe=lR(),this.Me=am.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=oK(),t=oK(),r=oK();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:il(38017,{changeType:i})}}),new lS(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=lR()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ih(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class lN{constructor(e){this.Ge=e,this.ze=new Map,this.je=oV,this.He=lD(),this.Je=lD(),this.Ze=new al(iT)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:il(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(ov(a))if(0===r){let e=new iO(a.path);this.et(t,e,a6.newNoDocument(e,iq.min()))}else ih(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),ly?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=a_(i).toUint8Array()}catch(e){if(e instanceof ag)return ia("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new lI(t,s,a)}catch(e){return ia(e instanceof lE?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&ov(i.target)){let t=new iO(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,a6.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=oK();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new lT(e,t,this.Ze,this.je,r);return this.je=oV,this.He=lD(),this.Je=lD(),this.Ze=new al(iT),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new lx,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new ac(iT),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new ac(iT),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||ii("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new lx),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function lD(){return new al(iO.comparator)}function lR(){return new al(iO.comparator)}let lO={asc:"ASCENDING",desc:"DESCENDING"},lP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lL={and:"AND",or:"OR"};class lM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lF(e,t){return e.useProto3Json||sl(t)?t:{value:t}}function lV(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lU(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function lB(e){let t;return ih(!!e,49232),iq.fromTimestamp(new ij((t=av(e)).seconds,t.nanos))}function lj(e,t){return lq(e,t).canonicalString()}function lq(e,t){let r=new iN(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function lz(e){let t=iN.fromString(e);return ih(l5(t),10190,{key:t.toString()}),t}function l$(e,t){return lj(e.databaseId,t.path)}function lK(e,t){let r=lz(t);if(r.get(1)!==e.databaseId.projectId)throw new id(ic.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new id(ic.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new iO(lQ(r))}function lG(e,t){return lj(e.databaseId,t)}function lH(e){let t=lz(e);return 4===t.length?iN.emptyPath():lQ(t)}function lW(e){return new iN(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function lQ(e){return ih(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function lJ(e,t,r){return{name:l$(e,t),fields:r.value.mapValue.fields}}function lY(e,t,r){let n=lK(e,t.name),i=lB(t.updateTime),s=t.createTime?lB(t.createTime):iq.min(),a=new a2({mapValue:{fields:t.fields}}),o=a6.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function lX(e,t){var r,n;let i;if(t instanceof ln)i={update:lJ(e,t.key,t.value)};else if(t instanceof ll)i={delete:l$(e,t.key)};else if(t instanceof li){let r;i={update:lJ(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof lu))return il(16599,{dt:t.type});i={verify:l$(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof oY)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof oX)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof o0)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof o2)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw il(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:lV(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:il(27497)),i}function lZ(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?o8.updateTime(lB(r.updateTime)):void 0!==r.exists?o8.exists(r.exists):o8.none():o8.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(ih("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new oY):"appendMissingElements"in t?r=new oX(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new o0(t.removeAllFromArray.values||[]):"increment"in t?r=new o2(e,t.increment):il(16584,{proto:t}),new o5(iR.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=lK(e,t.update.name),s=new a2({mapValue:{fields:t.update.fields}});return t.updateMask?new li(r,s,new ap((t.updateMask.fieldPaths||[]).map(e=>iR.fromServerFormat(e))),n,i):new ln(r,s,n,i)}return t.delete?new ll(lK(e,t.delete),n):t.verify?new lu(lK(e,t.verify),n):il(1463,{proto:t})}function l0(e,t){return{documents:[lG(e,t.path)]}}function l1(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=lG(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof a9?function(e){if("=="===e.op){if(aW(e.value))return{unaryFilter:{field:l6(e.field),op:"IS_NAN"}};if(aH(e.value))return{unaryFilter:{field:l6(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aW(e.value))return{unaryFilter:{field:l6(e.field),op:"IS_NOT_NAN"}};if(aH(e.value))return{unaryFilter:{field:l6(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:l6(e.field),op:lP[e.op],value:e.value}}}(t):t instanceof oe?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:lL[r.op],filters:n}}:il(54877,{filter:t})}(oe.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:l6(e.field),direction:lO[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=lF(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function l2(e){var t,r,n;let i,s,a,o,l=lH(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){ih(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=l3(e.unaryFilter.field);return a9.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=l3(e.unaryFilter.field);return a9.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=l3(e.unaryFilter.field);return a9.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=l3(e.unaryFilter.field);return a9.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return il(61313);default:return il(60726)}}(t):void 0!==t.fieldFilter?a9.create(l3(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return il(58110);default:return il(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?oe.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return il(1026)}}(t.compositeFilter.op)):il(30097,{filter:t})}(u.where))instanceof oe&&on(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new a8(l3(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=sl(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(r=u.startAt).before,g=new a3(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new a3(n.values||[],o)),new oI(l,c,f,d,p,"F",g,m)}function l6(e){return{fieldPath:e.canonicalString()}}function l3(e){return iR.fromServerFormat(e.fieldPath)}function l5(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function l4(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class l8{constructor(e,t,r,n,i=iq.min(),s=iq.min(),a=am.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new l8(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new l8(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new l8(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new l8(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class l7{constructor(e){this.yt=e}}function l9(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:ue(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:l$(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:lV(i,t.version.toTimestamp()),createTime:lV(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:ut(t.version)};else{if(!t.isUnknownDocument())return il(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:ut(t.version)}}return n}function ue(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ut(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ur(e){let t=new ij(e.seconds,e.nanoseconds);return iq.fromTimestamp(t)}function un(e,t){let r=(t.baseMutations||[]).map(t=>lZ(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>lZ(e.yt,t)),i=ij.fromMillis(t.localWriteTimeMs);return new lh(t.batchId,i,r,n)}function ui(e){var t;let r,n=ur(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ur(e.lastLimboFreeSnapshotVersion):iq.min();return new l8(void 0!==e.query.documents?(ih(1===(r=(t=e.query).documents.length),1966,{count:r}),oA(oE(lH(t.documents[0])))):oA(l2(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,am.fromBase64String(e.resumeToken))}function us(e,t){let r,n=ut(t.snapshotVersion),i=ut(t.lastLimboFreeSnapshotVersion);r=ov(t.target)?l0(e.yt,t.target):l1(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:om(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ua(e){let t=l2({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?oN(t,t.limit,"L"):t}function uo(e,t){return new ld(t.largestBatchId,lZ(e.yt,t.overlayMutation))}function ul(e,t){let r=t.path.lastSegment();return[e,sc(t.path.popLast()),r]}function uu(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:ut(n.readTime),documentKey:sc(n.documentKey.path),largestBatchId:n.largestBatchId}}class uh{getBundleMetadata(e,t){return ai(e,sz).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:ur(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return ai(e,sz).put({bundleId:t.id,createTime:ut(lB(t.createTime)),version:t.version})}getNamedQuery(e,t){return ai(e,s$).get(t).next(e=>{if(e)return{name:e.name,query:ua(e.bundledQuery),readTime:ur(e.readTime)}})}saveNamedQuery(e,t){return ai(e,s$).put({name:t.name,readTime:ut(lB(t.readTime)),bundledQuery:t.bundledQuery})}}class uc{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new uc(e,t.uid||"")}getOverlay(e,t){return ai(e,s1).get(ul(this.userId,t)).next(e=>e?uo(this.serializer,e):null)}getOverlays(e,t){let r=oq();return i2.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new ld(t,i);n.push(this.bt(e,s))}),i2.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(sc(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(ai(e,s1).X(s6,n))}),i2.waitFor(i)}getOverlaysForCollection(e,t,r){let n=oq(),i=sc(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return ai(e,s1).H(s6,s).next(e=>{for(let t of e){let e=uo(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=oq(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return ai(e,s1).ee({index:s5,range:a},(e,t,r)=>{let a=uo(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return ai(e,s1).put(function(e,t,r){let[n,i,s]=ul(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:lX(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class ud{St(e){return ai(e,s8)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?am.fromUint8Array(t):am.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class uf{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(aw(e.integerValue));else if("doubleValue"in e){let r=aw(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),su(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=av(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(a_(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?aX(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):aJ(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):il(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[aL].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(aw(n)),this.Ot(aL,t),this.Ct(r[aL],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),iO.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function up(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}uf.Wt=new uf;class ug{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=up(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=up(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class um{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class uy{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class uv{constructor(){this.cn=new ug,this.ascending=new um(this.cn),this.descending=new uy(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class uw{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new uw(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:uI(this.Tn),directionalValue:uI(this.In),orderedDocumentKey:uI(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function u_(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=ub(e.Tn,t.Tn))||0!==(r=ub(e.In,t.In))?r:iO.comparator(e.Pn,t.Pn)}function ub(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function uI(e){return X()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function uE(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class uT{constructor(e){for(const t of(this.Vn=new ac((e,t)=>iR.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(ih(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=i$(e);if(void 0!==t&&!this.pn(t))return!1;let r=iK(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new ac(iR.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new iH(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new iH(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new iH(r.field,+("asc"!==r.dir))));return new iz(iz.UNKNOWN_ID,this.collectionId,t,iW.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function uS(e){return e instanceof a9}function uC(e){return e instanceof oe&&on(e)}function uA(e){return uS(e)||uC(e)||function(e){if(e instanceof oe&&or(e)){for(let t of e.getFilters())if(!uS(t)&&!uC(t))return!1;return!0}return!1}(e)}function uk(e,t){return ih(e instanceof a9||e instanceof oe,38388),ih(t instanceof a9||t instanceof oe,25473),uN(e instanceof a9?t instanceof a9?oe.create([e,t],"and"):ux(e,t):t instanceof a9?ux(t,e):function(e,t){if(ih(e.filters.length>0&&t.filters.length>0,48005),ot(e)&&ot(t))return os(e,t.getFilters());let r=or(e)?e:t,n=or(e)?t:e,i=r.filters.map(e=>uk(e,n));return oe.create(i,"or")}(e,t))}function ux(e,t){if(ot(t))return os(t,e.getFilters());{let r=t.filters.map(t=>uk(e,t));return oe.create(r,"or")}}function uN(e){if(ih(e instanceof a9||e instanceof oe,11850),e instanceof a9)return e;let t=e.getFilters();if(1===t.length)return uN(t[0]);if(oi(e))return e;let r=t.map(e=>uN(e)),n=[];return r.forEach(t=>{t instanceof a9?n.push(t):t instanceof oe&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:oe.create(n,e.op)}class uD{constructor(){this.Sn=new uR}addToCollectionParentIndex(e,t){return this.Sn.add(t),i2.resolve()}getCollectionParents(e,t){return i2.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return i2.resolve()}deleteFieldIndex(e,t){return i2.resolve()}deleteAllFieldIndexes(e){return i2.resolve()}createTargetIndexes(e,t){return i2.resolve()}getDocumentsMatchingTarget(e,t){return i2.resolve(null)}getIndexType(e,t){return i2.resolve(0)}getFieldIndexes(e,t){return i2.resolve([])}getNextCollectionGroupToUpdate(e){return i2.resolve(null)}getMinOffset(e,t){return i2.resolve(iY.min())}getMinOffsetFromCollectionGroup(e,t){return i2.resolve(iY.min())}updateCollectionGroup(e,t,r){return i2.resolve()}updateIndexEntries(e,t){return i2.resolve()}}class uR{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new ac(iN.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new ac(iN.comparator)).toArray()}}let uO="IndexedDbIndexManager",uP=new Uint8Array(0);class uL{constructor(e,t){this.databaseId=t,this.Dn=new uR,this.Cn=new oF(e=>om(e),(e,t)=>oy(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:sc(n)};return ai(e,sB).put(i)}return i2.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ai(e,sB).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(sd(n.parent))}return r})}addFieldIndex(e,t){let r=ai(e,sK),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=ai(e,sH);return i.next(e=>{r.put(uu(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=ai(e,sK),n=ai(e,sH),i=ai(e,sY);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ai(e,sK),r=ai(e,sY),n=ai(e,sH);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return i2.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new uT(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=ai(e,sY),n=!0,i=new Map;return i2.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=oK(),n=[];return i2.forEach(i,(i,s)=>{ii(uO,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${om(t)}`);let a=function(e,t){let r=i$(t);if(void 0===r)return null;for(let t of ow(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of iK(t))for(let t of ow(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of iK(t)){let t=0===i.kind?o_(e,i.fieldPath,e.startAt):ob(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new a3(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of iK(t)){let t=0===i.kind?ob(e,i.fieldPath,e.endAt):o_(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new a3(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return i2.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=iO.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return i2.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(ih(t instanceof a9||t instanceof oe,34018),t instanceof a9)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=oe.create(r,t.op);return uA(n=uN(n))?n:(ih(n instanceof oe,64498),ih(ot(n),40251),ih(n.filters.length>1,57927),n.filters.reduce((e,t)=>uk(e,t)))}(function e(t){if(ih(t instanceof a9||t instanceof oe,20012),t instanceof a9){if(t instanceof oc){let e=t.value.arrayValue?.values?.map(e=>a9.create(t.field,"==",e))||[];return oe.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return oe.create(r,t.op)}(e));return ih(uA(t),7391),uS(t)||uC(t)?[t]:t.getFilters()})(oe.create(e.filters,"and")).map(t=>og(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):uP,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new uw(e,iO.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new uw(e,iO.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new uT(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return i2.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new ac(iR.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new uv;for(let n of iK(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);uf.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new uv;return uf.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new uv;return uf.Wt.Dt(a$(this.databaseId,t),n.ln(0===(r=iK(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new uv);let i=0;for(let s of iK(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&aG(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);uf.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new uv;n.seed(r.un()),uf.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof a9&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=ai(e,sK),n=ai(e,sH);return(t?r.H(sG,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return i2.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new iW(r.sequenceNumber,new iY(ur(r.readTime),new iO(sd(r.documentKey)),r.largestBatchId)):iW.empty(),i=e.fields.map(([e,t])=>new iH(iR.fromServerFormat(e),t)),new iz(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:iT(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=ai(e,sK),i=ai(e,sH);return this.Wn(e).next(e=>n.H(sG,IDBKeyRange.bound(t,t)).next(t=>i2.forEach(t,t=>i.put(uu(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return i2.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?i2.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),i2.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?i2.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return ai(e,sY).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return ai(e,sY).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=ai(e,sY),i=new ac(u_);return n.ee({index:sZ,range:IDBKeyRange.only([r.indexId,this.uid,uI(this.Kn(r,t))])},(e,n)=>{i=i.add(new uw(r.indexId,t,uE(n.arrayValue),uE(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new ac(u_),n=this.kn(t,e);if(null==n)return r;let i=i$(t);if(null!=i){let s=e.data.field(i.fieldPath);if(aG(s))for(let i of s.arrayValue.values||[])r=r.add(new uw(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new uw(t.indexId,e.key,uP,n));return r}zn(e,t,r,n,i){ii(uO,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=af(s),l=af(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=af(a)):t?(i(o),o=af(s)):(o=af(s),l=af(a))}}(n,i,u_,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),i2.waitFor(s)}Wn(e){let t=1;return ai(e,sH).ee({index:sQ,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>u_(e,t)).filter((e,t,r)=>!t||0!==u_(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=u_(i,e),s=u_(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,uP,iO.empty()),r=n[e+1].An(this.uid,uP,iO.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return u_(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(uM)}getMinOffset(e,t){return i2.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||il(44426))).next(uM)}}function uM(e){ih(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>iX(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new iY(t.readTime,t.documentKey,r)}let uF={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class uV{static withCacheSize(e){return new uV(e,uV.DEFAULT_COLLECTION_PERCENTILE,uV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function uU(e,t,r){let n=e.store(sy),i=e.store(sI),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{ih(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,sc(h),c]);s.push(i.delete(n)),u.push(e.key)}return i2.waitFor(s).next(()=>u)}function uB(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw il(14731);t=e.noDocument}return JSON.stringify(t).length}uV.DEFAULT_COLLECTION_PERCENTILE=10,uV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,uV.DEFAULT=new uV(0x2800000,uV.DEFAULT_COLLECTION_PERCENTILE,uV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),uV.DISABLED=new uV(-1,0,0);class uj{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return ih(""!==e.uid,64387),new uj(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return uz(e).ee({index:sw,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=ai(e,sI),s=uz(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;ih("number"==typeof a,49019);let f=new lh(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>lX(o.yt,e)),d=f.mutations.map(e=>lX(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new ac((e,t)=>iT(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,sc(h),a]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,sb))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),i2.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return uz(e).get(t).next(e=>e?(ih(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),un(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?i2.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return uz(e).ee({index:sw,range:n},(e,t,n)=>{t.userId===this.userId&&(ih(t.batchId>=r,47524,{Yn:r}),i=un(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return uz(e).ee({index:sw,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return uz(e).H(sw,t).next(e=>e.map(e=>un(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,sc(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return ai(e,sI).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=sd(o);if(a===this.userId&&t.path.isEqual(u))return uz(e).get(l).next(e=>{if(!e)throw il(61480,{er:r,batchId:l});ih(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(un(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ac(iT),n=[];return t.forEach(t=>{let i=[this.userId,sc(t.path)],s=IDBKeyRange.lowerBound(i),a=ai(e,sI).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=sd(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),i2.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,sc(r)],s=IDBKeyRange.lowerBound(i),a=new ac(iT);return ai(e,sI).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=sd(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(uz(e).get(t).next(e=>{if(null===e)throw il(35274,{batchId:t});ih(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(un(this.serializer,e))}))}),i2.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return uU(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),i2.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return i2.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return ai(e,sI).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=sd(e[1]);n.push(t)}else r.done()}).next(()=>{ih(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return uq(e,this.userId,t)}ir(e){return ai(e,sm).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function uq(e,t,r){let n=[t,sc(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return ai(e,sI).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function uz(e){return ai(e,sy)}class u${constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new u$(0)}static ar(){return new u$(-1)}}class uK{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new u$(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>iq.fromTimestamp(new ij(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ai(e,sD).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(ih(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return ai(e,sD).ee((s,a)=>{let o=ui(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>i2.waitFor(i)).next(()=>n)}forEachTarget(e,t){return ai(e,sD).ee((e,r)=>{t(ui(r))})}ur(e){return ai(e,sU).get(sV).next(e=>(ih(null!==e,2888),e))}cr(e,t){return ai(e,sU).put(sV,t)}lr(e,t){return ai(e,sD).put(us(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=om(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return ai(e,sD).ee({range:n,index:sR},(e,r,n)=>{let s=ui(r);oy(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=uG(e);return t.forEach(t=>{let s=sc(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),i2.waitFor(n)}removeMatchingKeys(e,t,r){let n=uG(e);return i2.forEach(t,t=>{let i=sc(t.path);return i2.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=uG(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=uG(e),i=oK();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new iO(sd(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=sc(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return uG(e).ee({index:sM,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return ai(e,sD).get(t).next(e=>e?ui(e):null)}}function uG(e){return ai(e,sP)}let uH="LruGarbageCollector";function uW([e,t],[r,n]){let i=iT(e,r);return 0===i?iT(t,n):i}class uQ{constructor(e){this.Pr=e,this.buffer=new ac(uW),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>uW(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uJ{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){ii(uH,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){i9(e)?ii(uH,"Ignoring IndexedDB error during garbage collection: ",e):await i1(e)}await this.Ar(3e5)})}}class uY{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return i2.resolve(so.ce);let r=new uQ(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector","Garbage collection skipped; disabled"),i2.resolve(uF)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uF):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ii("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),ir()<=l.DEBUG&&ii("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(u-o)+"ms\n"+`Total Duration: ${u-h}ms`),i2.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class uX{constructor(e,t){this.db=e,this.garbageCollector=new uY(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return uZ(e,r)}removeReference(e,t,r){return uZ(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return uZ(e,t)}wr(e,t){let r;return r=!1,ai(e,sm).te(n=>uq(e,n,t).next(e=>(e&&(r=!0),i2.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,iq.min()),uG(e).delete([0,sc(s.path)])))});n.push(t)}}).next(()=>i2.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return uZ(e,t)}yr(e,t){let r=uG(e),n,i=so.ce;return r.ee({index:sM},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==so.ce&&t(new iO(sd(n)),i),i=a,n=s):i=so.ce}).next(()=>{i!==so.ce&&t(new iO(sd(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uZ(e,t){var r;return uG(e).put((r=e.currentSequenceNumber,{targetId:0,path:sc(t.path),sequenceNumber:r}))}class u0{constructor(){this.changes=new oF(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,a6.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?i2.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class u1{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ai(e,sE).put(r)}removeEntry(e,t,r){let n;return ai(e,sE).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],ue(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=a6.newInvalidDocument(t);return ai(e,sE).ee({index:sS,range:IDBKeyRange.only(u6(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:a6.newInvalidDocument(t)};return ai(e,sE).ee({index:sS,range:IDBKeyRange.only(u6(t))},(e,n)=>{r={document:this.Sr(t,n),size:uB(n)}}).next(()=>r)}getEntries(e,t){let r=oV;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=oV,n=new al(iO.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,uB(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return i2.resolve();let n=new ac(u5);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(u6(n.first()),u6(n.last())),s=n.getIterator(),a=s.getNext();return ai(e,sE).ee({index:sS,range:i},(e,t,n)=>{let i=iO.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>u5(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(u6(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),ue(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ai(e,sE).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oV;for(let i of e){let e=this.Sr(iO.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(oP(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oV,s=u3(t,r),a=u3(t,iY.max());return ai(e,sE).ee({index:sA,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(iO.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new u2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return ai(e,sx).get(sN).next(e=>(ih(!!e,20021),e))}br(e,t){return ai(e,sx).put(sN,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=lY(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=iO.fromSegments(t.noDocument.path),r=ur(t.noDocument.readTime);n=a6.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return il(56709);{let e=iO.fromSegments(t.unknownDocument.path),r=ur(t.unknownDocument.version);n=a6.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new ij((r=t.readTime)[0],r[1]),iq.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(iq.min())))return e}return a6.newInvalidDocument(e)}}class u2 extends u0{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new oF(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new ac((e,t)=>iT(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=l9(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=uB(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=l9(this.Mr.serializer,s.convertToNoDocument(iq.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),i2.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function u6(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function u3(e,t){let r=t.documentKey.path.toArray();return[e,ue(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function u5(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=iT(r[e],n[e]))return i;return(i=iT(r.length,n.length))||(i=iT(r[r.length-2],n[n.length-2]))||iT(r[r.length-1],n[n.length-1])}class u4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class u8{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&lt(r.mutation,e,ap.empty(),ij.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oK()).next(()=>t))}getLocalViewOfDocuments(e,t,r=oK()){let n=oq();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=oB();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=oq();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oK()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oV,s=oq(),a=oq();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof li)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),lt(a.mutation,t,a.mutation.getFieldMask(),ij.now())):s.set(t.key,ap.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new u4(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oq(),n=new al((e,t)=>e-t),i=oK();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||ap.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||oK()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=oq();l.forEach(e=>{if(!i.has(e)){let n=le(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return i2.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return iO.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):oS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):i2.resolve(oq()),a=-1,o=i;return s.next(t=>i2.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?i2.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,oK())).next(e=>({batchId:a,changes:oj(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new iO(t)).next(e=>{let t=oB();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=oB();return this.indexManager.getCollectionParents(e,i).next(a=>i2.forEach(a,a=>{let o=new oI(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,a6.newInvalidDocument(n)))});let r=oB();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&lt(s.mutation,n,ap.empty(),ij.now()),oP(t,n)&&(r=r.insert(e,n))}),r})}}class u7{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return i2.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:lB(t.createTime)}),i2.resolve()}getNamedQuery(e,t){return i2.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:ua(t.bundledQuery),readTime:lB(t.readTime)}),i2.resolve()}}class u9{constructor(){this.overlays=new al(iO.comparator),this.Lr=new Map}getOverlay(e,t){return i2.resolve(this.overlays.get(t))}getOverlays(e,t){let r=oq();return i2.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),i2.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),i2.resolve()}getOverlaysForCollection(e,t,r){let n=oq(),i=t.length+1,s=new iO(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return i2.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new al((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=oq(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=oq(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return i2.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new ld(t,r));let i=this.Lr.get(t);void 0===i&&(i=oK(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class he{constructor(){this.sessionToken=am.EMPTY_BYTE_STRING}getSessionToken(e){return i2.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,i2.resolve()}}class ht{constructor(){this.kr=new ac(hr.Kr),this.qr=new ac(hr.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new hr(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new hr(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new iO(new iN([])),r=new hr(t,e),n=new hr(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new iO(new iN([])),r=new hr(t,e),n=new hr(t,e+1),i=oK();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new hr(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class hr{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return iO.comparator(e.key,t.key)||iT(e.Hr,t.Hr)}static Ur(e,t){return iT(e.Hr,t.Hr)||iO.comparator(e.key,t.key)}}class hn{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new ac(hr.Kr)}checkEmpty(e){return i2.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new lh(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new hr(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return i2.resolve(s)}lookupMutationBatch(e,t){return i2.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return i2.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return i2.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return i2.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new hr(t,0),n=new hr(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),i2.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ac(iT);return t.forEach(e=>{let t=new hr(e,0),n=new hr(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),i2.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;iO.isDocumentKey(i)||(i=i.child(""));let s=new hr(new iO(i),0),a=new ac(iT);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),i2.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){ih(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return i2.forEach(t.mutations,n=>{let i=new hr(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new hr(t,0),n=this.Jr.firstAfterOrEqual(r);return i2.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,i2.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class hi{constructor(e){this.ti=e,this.docs=new al(iO.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return i2.resolve(r?r.document.mutableCopy():a6.newInvalidDocument(t))}getEntries(e,t){let r=oV;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():a6.newInvalidDocument(e))}),i2.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oV,s=t.path,a=new iO(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=iX(iJ(a),r)||(n.has(a.key)||oP(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return i2.resolve(i)}getAllFromCollectionGroup(e,t,r,n){il(9500)}ni(e,t){return i2.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new hs(this)}getSize(e){return i2.resolve(this.size)}}class hs extends u0{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),i2.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class ha{constructor(e){this.persistence=e,this.ri=new oF(e=>om(e),oy),this.lastRemoteSnapshotVersion=iq.min(),this.highestTargetId=0,this.ii=0,this.si=new ht,this.targetCount=0,this.oi=u$._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),i2.resolve()}getLastRemoteSnapshotVersion(e){return i2.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return i2.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),i2.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),i2.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new u$(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,i2.resolve()}updateTargetData(e,t){return this.lr(t),i2.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,i2.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),i2.waitFor(i).next(()=>n)}getTargetCount(e){return i2.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return i2.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),i2.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),i2.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),i2.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return i2.resolve(r)}containsKey(e,t){return i2.resolve(this.si.containsKey(t))}}class ho{constructor(e,t){this._i={},this.overlays={},this.ai=new so(0),this.ui=!1,this.ui=!0,this.ci=new he,this.referenceDelegate=e(this),this.li=new ha(this),this.indexManager=new uD,this.remoteDocumentCache=new hi(e=>this.referenceDelegate.hi(e)),this.serializer=new l7(t),this.Pi=new u7(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new u9,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new hn(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){ii("MemoryPersistence","Starting transaction:",e);let n=new hl(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return i2.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class hl extends i0{constructor(e){super(),this.currentSequenceNumber=e}}class hu{constructor(e){this.persistence=e,this.Ri=new ht,this.Ai=null}static Vi(e){return new hu(e)}get di(){if(this.Ai)return this.Ai;throw il(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),i2.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),i2.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),i2.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return i2.forEach(this.di,r=>{let n=iO.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,iq.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return i2.or([()=>i2.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class hh{constructor(e,t){this.persistence=e,this.fi=new oF(e=>sc(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new uY(this,t)}static Vi(e,t){return new hh(e,t)}Ti(){}Ii(e){return i2.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return i2.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?i2.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,iq.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),i2.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),i2.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),i2.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),i2.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(aF(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=aC(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return a_(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,aa(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw il(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return i2.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return i2.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class hc{constructor(e){this.serializer=e}k(e,t,r,n){let i=new i3("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(sp),e.createObjectStore(sm,{keyPath:"userId"}),e.createObjectStore(sy,{keyPath:sv,autoIncrement:!0}).createIndex(sw,s_,{unique:!0}),e.createObjectStore(sI),hd(e),e.createObjectStore(sf));let s=i2.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(sP),e.deleteObjectStore(sD),e.deleteObjectStore(sU),hd(e)),s=s.next(()=>{let e,t;return e=i.store(sU),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:iq.min().toTimestamp(),targetCount:0},e.put(sV,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(sy).H().next(t=>{e.deleteObjectStore(sy),e.createObjectStore(sy,{keyPath:sv,autoIncrement:!0}).createIndex(sw,s_,{unique:!0});let r=i.store(sy),n=t.map(e=>r.put(e));return i2.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(sq,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(sx),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(sz,{keyPath:"bundleId"}),e.createObjectStore(s$,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(s1,{keyPath:s2})).createIndex(s6,s3,{unique:!1}),t.createIndex(s5,s4,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(sE,{keyPath:sT})).createIndex(sS,sC),t.createIndex(sA,sk)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(sf))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(sK,{keyPath:"indexId",autoIncrement:!0}).createIndex(sG,"collectionGroup",{unique:!1}),e.createObjectStore(sH,{keyPath:sW}).createIndex(sQ,sJ,{unique:!1}),e.createObjectStore(sY,{keyPath:sX}).createIndex(sZ,s0,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(sH).clear()}).next(()=>{t.objectStore(sY).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(s8,{keyPath:"name"})})),r<18&&n>=18&&X()&&(s=s.next(()=>{t.objectStore(sH).clear()}).next(()=>{t.objectStore(sY).clear()})),s}pi(e){let t=0;return e.store(sf).ee((e,r)=>{t+=uB(r)}).next(()=>{let r={byteSize:t};return e.store(sx).put(sN,r)})}gi(e){let t=e.store(sm),r=e.store(sy);return t.H().next(t=>i2.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(sw,n).next(r=>i2.forEach(r,r=>{ih(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=un(this.serializer,r);return uU(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(sP),r=e.store(sf);return e.store(sU).get(sV).next(e=>{let n=[];return r.ee((r,i)=>{let s=new iN(r),a=[0,sc(s)];n.push(t.get(a).next(r=>r?i2.resolve():t.put({targetId:0,path:sc(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>i2.waitFor(n))})}wi(e,t){e.createObjectStore(sB,{keyPath:sj});let r=t.store(sB),n=new uR,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:sc(n)})}};return t.store(sf).ee({Y:!0},(e,t)=>i(new iN(e).popLast())).next(()=>t.store(sI).ee({Y:!0},([e,t,r],n)=>i(sd(t).popLast())))}bi(e){let t=e.store(sD);return t.ee((e,r)=>{let n=ui(r),i=us(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(sf),n=[];return r.ee((e,r)=>{let i=t.store(sE),s=(r.document?new iO(iN.fromString(r.document.name).popFirst(5)):r.noDocument?iO.fromSegments(r.noDocument.path):r.unknownDocument?iO.fromSegments(r.unknownDocument.path):il(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>i2.waitFor(n))}Di(e,t){let r=t.store(sy),n=new u1(this.serializer),i=new ho(hu.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??oK();un(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),i2.forEach(r,(e,r)=>{let s=new n9(r),a=uc.wt(this.serializer,s),o=i.getIndexManager(s);return new u8(n,uj.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new an(t,so.ce),e).next()})})}}function hd(e){e.createObjectStore(sP,{keyPath:sL}).createIndex(sM,sF,{unique:!0}),e.createObjectStore(sD,{keyPath:"targetId"}).createIndex(sR,sO,{unique:!0}),e.createObjectStore(sU)}let hf="IndexedDbPersistence",hp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class hg{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!hg.v())throw new id(ic.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uX(this,n),this.Ki=t+"main",this.serializer=new l7(o),this.qi=new i5(this.Ki,this.xi,new hc(this.serializer)),this.ci=new ud,this.li=new uK(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new u1(this.serializer),this.Pi=new uh,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&is(hf,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new id(ic.FAILED_PRECONDITION,hp);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new so(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ai(e,sq).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(i9(e))return ii(hf,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ii(hf,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return ai(e,sp).get(sg).next(e=>i2.resolve(this.Xi(e)))}Yi(e){return ai(e,sq).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ai(e,sq);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return i2.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?i2.resolve(!0):ai(e,sp).get(sg).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new id(ic.FAILED_PRECONDITION,hp);return!1}}return!(!this.networkEnabled||!this.inForeground)||ai(e,sq).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ii(hf,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[sp,sq],e=>{let t=new an(e,so.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>ai(e,sq).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return uj.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uL(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return uc.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;ii(hf,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?ar:16===n||15===n?at:14===n||13===n?ae:12===n?s9:11===n?s7:void il(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new an(n,this.ai?this.ai.next():so.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw is(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new id(ic.FAILED_PRECONDITION,iZ);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return ai(e,sp).get(sg).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new id(ic.FAILED_PRECONDITION,hp)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ai(e,sp).put(sg,t)}static v(){return i5.v()}Ji(e){let t=ai(e,sp);return t.get(sg).next(e=>this.Xi(e)?(ii(hf,"Releasing primary lease."),t.delete(sg)):i2.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(is(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;Y()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return ii(hf,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return is(hf,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){is("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function hm(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class hy{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=oK(),n=oK();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new hy(e,t.fromCache,r,n)}}class hv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class hw{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=Y()?8:i4(W())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new hv;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(ir()<=l.DEBUG&&ii("QueryEngine","SDK will not create cache indexes for query:",oO(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),i2.resolve()):(ir()<=l.DEBUG&&ii("QueryEngine","Query:",oO(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(ir()<=l.DEBUG&&ii("QueryEngine","The SDK decides to create cache indexes for query:",oO(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oA(t))):i2.resolve())}gs(e,t){if(oT(t))return i2.resolve(null);let r=oA(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=oA(t=oN(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=oK(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,oN(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return oT(t)||n.isEqual(iq.min())?i2.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?i2.resolve(null):(ir()<=l.DEBUG&&ii("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oO(t)),this.Ds(e,s,t,iQ(n,-1)).next(e=>e))})}bs(e,t){let r=new ac(oM(e));return t.forEach((t,n)=>{oP(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return ir()<=l.DEBUG&&ii("QueryEngine","Using full collection scan to execute query:",oO(t)),this.fs.getDocumentsMatchingQuery(e,t,iY.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let h_="LocalStore";class hb{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new al(iT),this.Fs=new oF(e=>om(e),oy),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new u8(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function hI(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=oK();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function hE(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function hT(e,t,r){let n=oK(),i=oK();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oV;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(iq.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):ii(h_,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function hS(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,i2.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new l8(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function hC(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!i9(e))throw e;ii(h_,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function hA(e,t,r){let n=iq.min(),i=oK();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=oA(t),void 0!==(o=e.Fs.get(a))?i2.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:iq.min(),r?i:oK())).next(r=>(hN(e,oL(t),r),{documents:r,ks:i}))})}function hk(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function hx(e,t){let r=e.Ms.get(t)||iq.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,iQ(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(hN(e,t,r),r))}function hN(e,t,r){let n=e.Ms.get(t)||iq.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function hD(e,t,r,n){let i=oK(),s=oV;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await hS(e,oA(oE(iN.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>hT(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function hR(e,t,r=oK()){let n=await hS(e,oA(ua(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=lB(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(am.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let hO="firestore_clients";function hP(e,t){return`${hO}_${e}_${t}`}let hL="firestore_mutations";function hM(e,t,r){let n=`${hL}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let hF="firestore_targets";function hV(e,t){return`${hF}_${e}_${t}`}let hU="SharedClientState";class hB{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new id(n.error.code,n.error.message)),s?new hB(e,t,n.state,i):(is(hU,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hj{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new id(r.error.code,r.error.message)),i?new hj(e,r.state,n):(is(hU,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hq{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=oG;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sh(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new hq(e,i):(is(hU,`Failed to parse client data for instance '${e}': ${t}`),null)}}class hz{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hz(t.clientId,t.onlineState):(is(hU,`Failed to parse online state: ${e}`),null)}}class h${constructor(){this.activeTargetIds=oG}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hK{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new al(iT),this.started=!1,this.Zs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=hP(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new h$),this.eo=RegExp(`^${hO}_${l}_([^_]*)$`),this.no=RegExp(`^${hL}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${hF}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(hP(this.persistenceKey,e));if(t){let r=hq.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(hV(this.persistenceKey,e));if(t){let n=hj.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(hV(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return ii(hU,"READ",e,t),t}setItem(e,t){ii(hU,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ii(hU,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(ii(hU,"EVENT",e.key,e.newValue),e.key===this.Xs)return void is("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=so.ce;if(null!=e)try{let r=JSON.parse(e);ih("number"==typeof r,30636,{yo:e}),t=r}catch(e){is(hU,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==so.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new hB(this.currentUser,e,t,r),i=hM(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=hM(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=hV(this.persistenceKey,e),i=new hj(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return hq.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return hB.$s(new n9(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return hj.$s(r,t)}_o(e){return hz.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);ii(hU,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=oG;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class hG{constructor(){this.vo=new h$,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new h$,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hH{Mo(e){}shutdown(){}}let hW="ConnectivityMonitor";class hQ{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(ii(hW,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(ii(hW,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let hJ=null;function hY(){return null===hJ?hJ=0x10000000+Math.round(0x80000000*Math.random()):hJ++,"0x"+hJ.toString(16)}let hX="RestConnection",hZ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class h0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===ax?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=hY(),a=this.Qo(e,t.toUriEncodedString());ii(hX,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=q(l);return this.zo(e,a,o,r,u).then(t=>(ii(hX,`Received RPC '${e}' ${s}: `,t),t),t=>{throw ia(hX,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+ie,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=hZ[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class h1{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let h2="WebChannelConnection",h6=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class h3 extends h0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){h3.c_||(h6(y(),m.STAT_EVENT,e=>{e.stat===g.PROXY?ii(h2,"STAT_EVENT: detected buffering proxy"):e.stat===g.NOPROXY&&ii(h2,"STAT_EVENT: detected no buffering proxy")}),h3.c_=!0)}zo(e,t,r,n,i){let s=hY();return new Promise((i,a)=>{let o=new c;o.setWithCredentials(!0),o.listenOnce(f.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case p.NO_ERROR:let t=o.getResponseJson();ii(h2,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case p.TIMEOUT:ii(h2,`RPC '${e}' ${s} timed out`),a(new id(ic.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:let r=o.getStatus();if(ii(h2,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(ic).indexOf(e)>=0?e:ic.UNKNOWN);a(new id(r,t.message))}else a(new id(ic.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new id(ic.UNAVAILABLE,"Connection failed."));break;default:il(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{ii(h2,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(n);ii(h2,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=hY(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=i.join("");ii(h2,`Creating RPC '${e}' stream ${n}: ${l}`,a);let u=s.createWebChannel(l,a);this.I_(u);let h=!1,c=!1,f=new h1({Ho:t=>{c?ii(h2,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(ii(h2,`Opening RPC '${e}' stream ${n} transport.`),u.open(),h=!0),ii(h2,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},Jo:()=>u.close()});return h6(u,d.EventType.OPEN,()=>{c||(ii(h2,`RPC '${e}' stream ${n} transport opened.`),f.i_())}),h6(u,d.EventType.CLOSE,()=>{c||(c=!0,ii(h2,`RPC '${e}' stream ${n} transport closed`),f.o_(),this.E_(u))}),h6(u,d.EventType.ERROR,t=>{c||(c=!0,ia(h2,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.o_(new id(ic.UNAVAILABLE,"The operation could not be completed")))}),h6(u,d.EventType.MESSAGE,t=>{if(!c){let r=t.data[0];ih(!!r,16349);let i=r?.error||r[0]?.error;if(i){ii(h2,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=w[e];if(void 0!==t)return lm(t)}(t),s=i.message;void 0===r&&(r=ic.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),c=!0,f.o_(new id(r,s)),u.close()}else ii(h2,`RPC '${e}' stream ${n} received:`,r),f.__(r)}}),h3.u_(),setTimeout(()=>{f.s_()},0),f}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return v()}}function h5(){return"u">typeof window?window:null}function h4(){return"u">typeof document?document:null}function h8(e){return new lM(e,!0)}h3.c_=!1;class h7{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&ii("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let h9="PersistentStream";class ce{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new h7(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===ic.RESOURCE_EXHAUSTED?(is(t.toString()),is("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ic.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new id(ic.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ii(h9,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(ii(h9,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ct extends ce{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:il(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(ih(void 0===i||"string"==typeof i,58123),am.fromBase64String(i||"")):(ih(void 0===i||i instanceof n3.Buffer||i instanceof Uint8Array,16193),am.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new lk(s,a,o,l&&new id(void 0===l.code?ic.UNKNOWN:lm(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=lK(e,n.document.name),s=lB(n.document.updateTime),a=n.document.createTime?lB(n.document.createTime):iq.min(),o=new a2({mapValue:{fields:n.document.fields}}),l=a6.newFoundDocument(i,s,a,o);r=new lC(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=lK(e,n.document),s=n.readTime?lB(n.readTime):iq.min(),a=a6.newNoDocument(i,s);r=new lC([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=lK(e,n.document);r=new lC([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return il(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new lp(n,i);r=new lA(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return iq.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?iq.min():t.readTime?lB(t.readTime):iq.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=lW(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=ov(n)?{documents:l0(e,n)}:{query:l1(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=lU(e,t.resumeToken);let n=lF(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(iq.min())>0){r.readTime=lV(e,t.snapshotVersion.toTimestamp());let n=lF(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return il(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=lW(this.serializer),t.removeTarget=e,this.K_(t)}}class cr extends ce{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ih(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ih(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;ih(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(ih(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?lB(e.updateTime):lB(r)).isEqual(iq.min())&&(t=lB(r)),new o4(t,e.transformResults||[])})):[]),i=lB(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=lW(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>lX(this.serializer,e))};this.K_(t)}}class cn{}class ci extends cn{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new id(ic.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,lq(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===ic.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new id(ic.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,lq(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===ic.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new id(ic.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class cs{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(is(t),this.aa=!1):ii("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let ca="RemoteStore";class co{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{cm(this)&&(ii(ca,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await cu(e),e.Va.set("Unknown"),e.Ea.delete(4),await cl(e)}(this))})}),this.Va=new cs(r,n)}}async function cl(e){if(cm(e))for(let t of e.Ra)await t(!0)}async function cu(e){for(let t of e.Ra)await t(!1)}function ch(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),cg(e)?cp(e):cR(e).O_()&&cd(e,t))}function cc(e,t){let r=cR(e);e.Ia.delete(t),r.O_()&&cf(e,t),0===e.Ia.size&&(r.O_()?r.L_():cm(e)&&e.Va.set("Unknown"))}function cd(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(iq.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}cR(e).Z_(t)}function cf(e,t){e.da.$e(t),cR(e).X_(t)}function cp(e){e.da=new lN({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),cR(e).start(),e.Va.ua()}function cg(e){return cm(e)&&!cR(e).x_()&&e.Ia.size>0}function cm(e){return 0===e.Ea.size}async function cy(e){e.Va.set("Online")}async function cv(e){e.Ia.forEach((t,r)=>{cd(e,t)})}async function cw(e,t){e.da=void 0,cg(e)?(e.Va.ha(t),cp(e)):e.Va.set("Unknown")}async function c_(e,t,r){if(e.Va.set("Online"),t instanceof lk&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){ii(ca,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await cb(e,r)}else if(t instanceof lC?e.da.Xe(t):t instanceof lA?e.da.st(t):e.da.tt(t),!r.isEqual(iq.min()))try{let t,n=await hE(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(am.EMPTY_BYTE_STRING,n.snapshotVersion)),cf(e,t);let i=new l8(n.target,t,r,n.sequenceNumber);cd(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ii(ca,"Failed to raise snapshot:",t),await cb(e,t)}}async function cb(e,t,r){if(!i9(t))throw t;e.Ea.add(1),await cu(e),e.Va.set("Offline"),r||(r=()=>hE(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ii(ca,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await cl(e)})}function cI(e,t){return t().catch(r=>cb(e,r,t))}async function cE(e){var t;let r=cO(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;cm(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=cO(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await cb(e,t)}cT(e)&&cS(e)}function cT(e){return cm(e)&&!cO(e).x_()&&e.Ta.length>0}function cS(e){cO(e).start()}async function cC(e){cO(e).ra()}async function cA(e){let t=cO(e);for(let r of e.Ta)t.ea(r.mutations)}async function ck(e,t,r){let n=e.Ta.shift(),i=lc.from(n,t,r);await cI(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await cE(e)}async function cx(e,t){t&&cO(e).Y_&&await async function(e,t){var r;if(lg(r=t.code)&&r!==ic.ABORTED){let r=e.Ta.shift();cO(e).B_(),await cI(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await cE(e)}}(e,t),cT(e)&&cS(e)}async function cN(e,t){e.asyncQueue.verifyOperationInProgress(),ii(ca,"RemoteStore received new credentials");let r=cm(e);e.Ea.add(3),await cu(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await cl(e)}async function cD(e,t){t?(e.Ea.delete(2),await cl(e)):t||(e.Ea.add(2),await cu(e),e.Va.set("Unknown"))}function cR(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:cy.bind(null,e),Yo:cv.bind(null,e),t_:cw.bind(null,e),J_:c_.bind(null,e)},t.sa(),e.ma=new ct(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),cg(e)?cp(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function cO(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:cC.bind(null,e),t_:cx.bind(null,e),ta:cA.bind(null,e),na:ck.bind(null,e)},t.sa(),e.fa=new cr(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await cE(e)):(await e.fa.stop(),e.Ta.length>0&&(ii(ca,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class cP{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new ip,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new cP(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new id(ic.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cL(e,t){if(is("AsyncQueue",`${t}: ${e}`),i9(e))return new id(ic.UNAVAILABLE,`${t}: ${e}`);throw e}class cM{static emptySet(e){return new cM(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||iO.comparator(t.key,r.key):(e,t)=>iO.comparator(e.key,t.key),this.keyedMap=oB(),this.sortedSet=new al(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cM)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new cM;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class cF{constructor(){this.ga=new al(iO.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):il(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class cV{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new cV(e,t,cM.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class cU{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class cB{constructor(){this.queries=cj(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new id(ic.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=cj(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function cj(){return new oF(e=>oR(e),oD)}async function cq(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new cU,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=cL(r,`Initialization of query '${oO(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&cG(e)}async function cz(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function c$(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&cG(e)}function cK(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function cG(e){e.Ca.forEach(e=>{e.next()})}(I=b||(b={})).Ma="default",I.Cache="cache";class cH{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new cV(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=cV.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==b.Cache}}class cW{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class cQ{constructor(e){this.serializer=e}Ks(e){return lK(this.serializer,e)}qs(e){return e.metadata.exists?lY(this.serializer,e.document,!1):a6.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return lB(e)}}class cJ{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=cY(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=iN.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new cQ(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||oK()).add(e);t.set(r,n)}}return t}async ja(e){let t=await hD(e,new cQ(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await hR(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function cY(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class cX{constructor(e){this.key=e}}class cZ{constructor(e){this.key=e}}class c0{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=oK(),this.mutatedKeys=oK(),this.eu=oM(e),this.tu=new cM(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new cF,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=oP(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return il(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new cV(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cF,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=oK(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new cZ(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new cX(r))}),t}cu(e){this.Za=e.ks,this.Ya=oK();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return cV.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let c1="SyncEngine";class c2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class c6{constructor(e){this.key=e,this.hu=!1}}class c3{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new oF(e=>oR(e),oD),this.Iu=new Map,this.Eu=new Set,this.Ru=new al(iO.comparator),this.Au=new Map,this.Vu=new ht,this.du={},this.mu=new Map,this.fu=u$.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function c5(e,t,r=!0){let n,i=dC(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await c8(i,t,r,!0),n}async function c4(e,t){let r=dC(e);await c8(r,t,!0,!1)}async function c8(e,t,r,n){let i,s=await hS(e.localStore,oA(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await c7(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&ch(e.remoteStore,s),i}async function c7(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await hA(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return dd(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await hA(e.localStore,t,!0),a=new c0(t,s.ks),o=a.ru(s.documents),l=lS.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);dd(e,r,u.au);let h=new c2(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function c9(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!oD(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await hC(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&cc(e.remoteStore,n.targetId),dh(e,n.targetId)}).catch(i1)):(dh(e,n.targetId),await hC(e.localStore,n.targetId,!0))}async function de(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),cc(e.remoteStore,r.targetId))}async function dt(e,t,r){let n=dA(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=ij.now(),l=t.reduce((e,t)=>e.add(t.key),oK()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=oV,s=oK();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=oJ(n.transform,e||null);null!=i&&(null===r&&(r=a2.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new li(r.key,t,function e(t){let r=[];return aa(t.fields,(t,n)=>{let i=new iR([t]);if(aQ(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new ap(r)}(t.value.mapValue),o8.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:oj(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new al(iT)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await dp(n,h.changes),await cE(n.remoteStore)}catch(t){let e=cL(t,"Failed to persist write");r.reject(e)}}async function dr(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(am.EMPTY_BYTE_STRING,iq.min()).withLastLimboFreeSnapshotVersion(iq.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=oV,l=oK();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(hT(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(iq.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return i2.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(ih(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?ih(n.hu,14607):t.removedDocuments.size>0&&(ih(n.hu,42227),n.hu=!1))}),await dp(e,s,t)}catch(e){await i1(e)}}function dn(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&cG(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function di(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new al(iO.comparator);r=r.insert(i,a6.newNoDocument(i,iq.min()));let n=oK().add(i),s=new lT(iq.min(),new Map,new al(iT),r,n);await dr(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),df(e)}else await hC(e.localStore,t,!1).then(()=>dh(e,t,r)).catch(i1)}async function ds(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=i2.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);ih(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=oK();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));du(e,n,null),dl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await dp(e,i)}catch(e){await i1(e)}}async function da(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ih(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));du(e,t,r),dl(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await dp(e,i)}catch(e){await i1(e)}}function dl(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function du(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function dh(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||dc(e,t)})}function dc(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(cc(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),df(e))}function dd(e,t,r){for(let n of r)n instanceof cX?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(ii(c1,"New document in limbo: "+r),e.Eu.add(n),df(e))}(e,n)):n instanceof cZ?(ii(c1,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||dc(e,n.key)):il(19791,{wu:n})}function df(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new iO(iN.fromString(t)),n=e.fu.next();e.Au.set(n,new c6(r)),e.Ru=e.Ru.insert(r,n),ch(e.remoteStore,new l8(oA(oE(r.path)),n,"TargetPurposeLimboResolution",so.ce))}}async function dp(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=hy.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>i2.forEach(t,t=>i2.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>i2.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!i9(e))throw e;ii(h_,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function dg(e,t){if(!e.currentUser.isEqual(t)){ii(c1,"User change. New user:",t.toKey());let r=await hI(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new id(ic.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await dp(e,r.Ns)}}function dm(e,t){let r=e.Au.get(t);if(r&&r.hu)return oK().add(r.key);{let r=oK(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function dy(e,t){let r=await hA(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&dd(e,t.targetId,n.au),n}async function dv(e,t){return hx(e.localStore,t).then(t=>dp(e,t))}async function dw(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):i2.resolve(null))));null!==o?("pending"===r?await cE(e.remoteStore):"acknowledged"===r||"rejected"===r?(du(e,t,n||null),dl(e,t),s=e.localStore,s.mutationQueue.nr(t)):il(6720,"Unknown batchState",{bu:r}),await dp(e,o)):ii(c1,"Cannot apply mutation batch with id: "+t)}async function d_(e,t){if(dC(e),dA(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await db(e,t.toArray());for(let t of(e.gu=!0,await cD(e.remoteStore,!0),r))ch(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(dh(e,i),hC(e.localStore,i,!0))),cc(e.remoteStore,i)}),await r,await db(e,t),e.Au.forEach((t,r)=>{cc(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new al(iO.comparator),e.gu=!1,await cD(e.remoteStore,!1)}}async function db(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await hS(e.localStore,oA(s[0])),s)){let t=e.Tu.get(r),n=await dy(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await hk(e.localStore,r);t=await hS(e.localStore,n),await c7(e,dI(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function dI(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new oI(t,r,n,i,s,"F",e.startAt,e.endAt)}function dE(e){return e.localStore.persistence.hs()}async function dT(e,t,r,n){if(e.gu)return void ii(c1,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await hx(e.localStore,oL(i[0])),s=lT.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,am.EMPTY_BYTE_STRING);await dp(e,n,s);break}case"rejected":await hC(e.localStore,t,!0),dh(e,t,n);break;default:il(64155,r)}}async function dS(e,t,r){let n=dC(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){ii(c1,"Adding an already active target "+e);continue}let t=await hk(n.localStore,e),r=await hS(n.localStore,t);await c7(n,dI(t),r.targetId,!1,r.resumeToken),ch(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await hC(n.localStore,e,!1).then(()=>{cc(n.remoteStore,e),dh(n,e)}).catch(i1)}}function dC(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=dr.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dm.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=di.bind(null,e),e.Pu.J_=c$.bind(null,e.eventManager),e.Pu.yu=cK.bind(null,e.eventManager),e}function dA(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=ds.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=da.bind(null,e),e}class dk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=h8(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new hw,new hb(t,r,e.initialUser,this.serializer)}Cu(e){return new ho(hu.Vi,this.serializer)}Du(e){return new hG}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}dk.provider={build:()=>new dk};class dx extends dk{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return ih(this.persistence.referenceDelegate instanceof hh,46915),new uJ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?uV.withCacheSize(this.cacheSizeBytes):uV.DEFAULT;return new ho(e=>hh.Vi(e,t),this.serializer)}}class dN extends dk{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await dA(this.xu.syncEngine),await cE(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new hw,new hb(t,r,e.initialUser,this.serializer)}Fu(e,t){return new uJ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new sa(t,this.persistence);return new ss(e.asyncQueue,r)}Cu(e){let t=hm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?uV.withCacheSize(this.cacheSizeBytes):uV.DEFAULT;return new hg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,h5(),h4(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new hG}}class dD extends dN{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof hK&&(this.sharedClientState.syncEngine={So:dw.bind(null,t),Do:dT.bind(null,t),Co:dS.bind(null,t),hs:dE.bind(null,t),bo:dv.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await d_(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=h5();if(!hK.v(t))throw new id(ic.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=hm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new hK(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class dR{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>dn(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=dg.bind(null,this.syncEngine),await cD(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cB}createDatastore(e){var t;let r=h8(e.databaseInfo.databaseId),n=new h3(e.databaseInfo);return t=e.authCredentials,new ci(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new co(t,r,e.asyncQueue,e=>dn(this.syncEngine,e,0),hQ.v()?new hQ:new hH)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new c3(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){ii(ca,"RemoteStore shutting down."),e.Ea.add(5),await cu(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function dO(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}dR.provider={build:()=>new dR};class dP{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):is("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class dL{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new ip,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new cW(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class dM{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new cW(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new id(ic.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class dF{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new id(ic.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>l$(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,iN.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(ih(!!t.found,43571),t.found.name,t.found.updateTime,n=lK(r,t.found.name),s=lB(t.found.updateTime),a=t.found.createTime?lB(t.found.createTime):iq.min(),o=new a2({mapValue:{fields:t.found.fields}}),a6.newFoundDocument(n,s,a,o)):"missing"in t?(ih(!!t.missing,3894),ih(!!t.readTime,22933),l=lK(r,t.missing),u=lB(t.readTime),a6.newNoDocument(l,u)):il(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());ih(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ll(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=iO.fromPath(t);this.mutations.push(new lu(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>lX(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,iN.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw il(50498,{Gu:e.constructor.name});t=iq.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new id(ic.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(iq.min())?o8.exists(!1):o8.updateTime(t):o8.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(iq.min()))throw new id(ic.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return o8.updateTime(t)}return o8.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class dV{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new h7(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new dF(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!sl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lg(t)}return!1}}let dU="FirestoreClient";class dB{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=n9.UNAUTHENTICATED,this.clientId=iE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{ii(dU,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(ii(dU,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ip;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=cL(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function dj(e,t){e.asyncQueue.verifyOperationInProgress(),ii(dU,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await hI(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function dq(e,t){e.asyncQueue.verifyOperationInProgress();let r=await dz(e);ii(dU,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>cN(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>cN(t.remoteStore,r)),e._onlineComponents=t}async function dz(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ii(dU,"Using user provided OfflineComponentProvider");try{await dj(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===ic.FAILED_PRECONDITION||t.code===ic.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;ia("Error using user provided cache. Falling back to memory cache: "+t),await dj(e,new dk)}}else ii(dU,"Using default OfflineComponentProvider"),await dj(e,new dx(void 0));return e._offlineComponents}async function d$(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ii(dU,"Using user provided OnlineComponentProvider"),await dq(e,e._uninitializedComponentsProvider._online)):(ii(dU,"Using default OnlineComponentProvider"),await dq(e,new dR))),e._onlineComponents}function dK(e){return dz(e).then(e=>e.localStore)}function dG(e){return d$(e).then(e=>e.syncEngine)}function dH(e){return d$(e).then(e=>e.datastore)}async function dW(e){let t=await d$(e),r=t.eventManager;return r.onListen=c5.bind(null,t.syncEngine),r.onUnlisten=c9.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=c4.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=de.bind(null,t.syncEngine),r}function dQ(e,t,r={}){let n=new ip;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dW(e),s=e.asyncQueue,a=new dP({next:e=>{a.Nu(),s.enqueueAndForget(()=>cz(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new id(ic.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new id(ic.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),cq(i,o=new cH(oE(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function dJ(e,t,r={}){let n=new ip;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dW(e),s=e.asyncQueue,o=new cH(t,a=new dP({next:e=>{a.Nu(),s.enqueueAndForget(()=>cz(i,o)),e.fromCache&&"server"===r.source?n.reject(new id(ic.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),cq(i,o)}),n.promise}function dY(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let dX=new Map,dZ="firestore.googleapis.com";class d0{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new id(ic.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dZ,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new id(ic.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new id(ic.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dY(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new id(ic.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new id(ic.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new id(ic.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class d1{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new d0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new id(ic.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new id(ic.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new d0(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new im;switch(e.type){case"firstParty":return new i_(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new id(ic.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=dX.get(this))&&(ii("ComponentProvider","Removing Datastore"),dX.delete(this),e.terminate()),Promise.resolve()}}class d2{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new d2(this.firestore,e,this._query)}}class d6{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new d3(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new d6(this.firestore,e,this._key)}toJSON(){return{type:d6._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(iB(t,d6._jsonSchema))return new d6(e,r||null,new iO(iN.fromString(t.referencePath)))}}d6._jsonSchemaVersion="firestore/documentReference/1.0",d6._jsonSchema={type:iU("string",d6._jsonSchemaVersion),referencePath:iU("string")};class d3 extends d2{constructor(e,t,r){super(e,t,oE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new d6(this.firestore,null,new iO(e))}withConverter(e){return new d3(this.firestore,e,this._path)}}function d5(e,t){return e=eh(e),t=eh(t),e instanceof d2&&t instanceof d2&&e.firestore===t.firestore&&oD(e._query,t._query)&&e.converter===t.converter}let d4="AsyncQueue";class d8{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new h7(this,"async_queue_retry"),this._c=()=>{let e=h4();e&&ii(d4,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=h4();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=h4();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new ip;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!i9(e))throw e;ii(d4,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,is("INTERNAL UNHANDLED ERROR: ",d7(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=cP.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&il(47125,{Pc:d7(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function d7(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class d9{constructor(){this._progressObserver={},this._taskCompletionResolver=new ip,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class fe extends d1{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new d8,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new d8(e),this._firestoreClient=void 0,await e}}}function ft(e){if(e._terminated)throw new id(ic.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new ak(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,dY(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new dB(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function fr(e,t){let r=ft(e=iF(e,fe)),n=new d9;return function(e,t,r,n){var i;let s=(i=h8(t),new dL(function(e,t){if(e instanceof Uint8Array)return dO(e,void 0);if(e instanceof ArrayBuffer)return dO(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?lv().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=lB(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(cY(a));let o=new cJ(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await dp(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return ia(c1,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await dG(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class fn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fn(am.fromBase64String(e))}catch(e){throw new id(ic.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new fn(am.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:fn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(iB(e,fn._jsonSchema))return fn.fromBase64String(e.bytes)}}fn._jsonSchemaVersion="firestore/bytes/1.0",fn._jsonSchema={type:iU("string",fn._jsonSchemaVersion),bytes:iU("string")};class fi{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new id(ic.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new iR(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fs{constructor(e){this._methodName=e}}class fa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new id(ic.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new id(ic.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return iT(this._lat,e._lat)||iT(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fa._jsonSchemaVersion}}static fromJSON(e){if(iB(e,fa._jsonSchema))return new fa(e.latitude,e.longitude)}}fa._jsonSchemaVersion="firestore/geoPoint/1.0",fa._jsonSchema={type:iU("string",fa._jsonSchemaVersion),latitude:iU("number"),longitude:iU("number")};class fo{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:fo._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(iB(e,fo._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new fo(e.vectorValues);throw new id(ic.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fo._jsonSchemaVersion="firestore/vectorValue/1.0",fo._jsonSchema={type:iU("string",fo._jsonSchemaVersion),vectorValues:iU("object")};let fl=/^__.*__$/;class fu{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new li(e,this.data,this.fieldMask,t,this.fieldTransforms):new ln(e,this.data,t,this.fieldTransforms)}}class fh{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new li(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fc(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw il(40011,{dataSource:e})}}class fd{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new fd({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return fA(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(fc(this.dataSource)&&fl.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class ff{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||h8(e)}createContext(e,t,r,n=!1){return new fd({dataSource:e,methodName:t,targetDoc:r,path:iR.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fp(e){let t=e._freezeSettings(),r=h8(e._databaseId);return new ff(e._databaseId,!!t.ignoreUndefinedProperties,r)}function fg(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);fE("Data must be an object, but it was:",l,n);let u=fb(n,l);if(s.merge)a=new ap(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=fT(t,n,r);if(!l.contains(i))throw new id(ic.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);fk(e,i)||e.push(i)}a=new ap(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new fu(new a2(u),a,o)}class fm extends fs{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof fm}}function fy(e,t,r,n){let i=e.createContext(1,t,r);fE("Data must be an object, but it was:",i,n);let s=[],a=a2.empty();return aa(n,(e,n)=>{let o=fC(t,e,r);n=eh(n);let l=i.childContextForFieldPath(o);if(n instanceof fm)s.push(o);else{let e=f_(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new fh(a,new ap(s),i.fieldTransforms)}function fv(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[fT(t,n,r)],l=[i];if(s.length%2!=0)throw new id(ic.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(fT(t,s[e])),l.push(s[e+1]);let u=[],h=a2.empty();for(let e=o.length-1;e>=0;--e)if(!fk(u,o[e])){let t=o[e],r=l[e];r=eh(r);let n=a.childContextForFieldPath(t);if(r instanceof fm)u.push(t);else{let e=f_(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new fh(h,new ap(u),a.fieldTransforms)}function fw(e,t,r,n=!1){return f_(r,e.createContext(n?4:3,t))}function f_(e,t){if(fI(e=eh(e)))return fE("Unsupported field value:",t,e),fb(e,t);if(e instanceof fs)return function(e,t){if(!fc(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=f_(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=eh(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,sh(n=e)?oW(n):oH(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ij.fromDate(e);return{timestampValue:lV(t.serializer,r)}}if(e instanceof ij){let r=new ij(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:lV(t.serializer,r)}}if(e instanceof fa)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof fn)return{bytesValue:lU(t.serializer,e._byteString)};if(e instanceof d6){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lj(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof fo)return{mapValue:{fields:{[aD]:{stringValue:aP},[aL]:{arrayValue:{values:((i=e)instanceof fo?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return oH(t.serializer,e)})}}}}};if(l4(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${iM(e)}`)}(e,t)}function fb(e,t){let r={};return ao(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):aa(e,(e,n)=>{let i=f_(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function fI(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ij||e instanceof fa||e instanceof fn||e instanceof d6||e instanceof fs||e instanceof fo||l4(e))}function fE(e,t,r){if(!fI(r)||!iL(r)){let n=iM(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function fT(e,t,r){if((t=eh(t))instanceof fi)return t._internalPath;if("string"==typeof t)return fC(e,t);throw fA("Field path arguments must be of type string or ",e,!1,void 0,r)}let fS=RegExp("[~\\*/\\[\\]]");function fC(e,t,r){if(t.search(fS)>=0)throw fA(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new fi(...t.split("."))._internalPath}catch(n){throw fA(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function fA(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new id(ic.INVALID_ARGUMENT,o+e+l)}function fk(e,t){return e.some(e=>e.isEqual(t))}class fx{convertValue(e,t="none"){switch(aF(e)){case 0:return null;case 1:return e.booleanValue;case 2:return aw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(a_(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw il(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return aa(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new fo(e.fields?.[aL].arrayValue?.values?.map(e=>aw(e.doubleValue)))}convertGeoPoint(e){return new fa(aw(e.latitude),aw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=aC(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(aA(e));default:return null}}convertTimestamp(e){let t=av(e);return new ij(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=iN.fromString(e);ih(l5(r),9688,{name:e});let n=new aN(r.get(1),r.get(3)),i=new iO(r.popFirst(5));return n.isEqual(t)||is(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class fN extends fx{constructor(e){super(),this.firestore=e}convertBytes(e){return new fn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new d6(this.firestore,null,t)}}let fD="@firebase/firestore",fR="4.10.0";function fO(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class fP{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class fL{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new a2({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class fM{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new d6(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new fF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(fT("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fF extends fM{data(){return super.data()}}function fV(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new id(ic.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fU{}class fB extends fU{}function fj(e,t,...r){let n=[];for(let i of(t instanceof fU&&n.push(t),function(e){let t=e.filter(e=>e instanceof f$).length,r=e.filter(e=>e instanceof fq).length;if(t>1||t>0&&r>0)throw new id(ic.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class fq extends fB{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new fq(e,t,r)}_apply(e){let t=this._parse(e);return f8(e._query,t),new d2(e.firestore,e.converter,ox(e._query,t))}_parse(e){let t=fp(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new id(ic.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){f4(a,s);let t=[];for(let r of a)t.push(f5(n,e,r));o={arrayValue:{values:t}}}else o=f5(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||f4(a,s),o=fw(r,t,a,"in"===s||"not-in"===s);return a9.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function fz(e,t,r){let n=fT("where",e);return fq._create(n,t,r)}class f$ extends fU{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new f$(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:oe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())f8(r,e),r=ox(r,e)}(e._query,t),new d2(e.firestore,e.converter,ox(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function fK(...e){return e.forEach(e=>f7("or",e)),f$._create("or",e)}function fG(...e){return e.forEach(e=>f7("and",e)),f$._create("and",e)}class fH extends fB{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new fH(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new id(ic.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new id(ic.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new a8(t,r)}(e._query,this._field,this._direction);return new d2(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new oI(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function fW(e,t="asc"){let r=fT("orderBy",e);return fH._create(r,t)}class fQ extends fB{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new fQ(e,t,r)}_apply(e){return new d2(e.firestore,e.converter,oN(e._query,this._limit,this._limitType))}}function fJ(e){return iV("limit",e),fQ._create("limit",e,"F")}function fY(e){return iV("limitToLast",e),fQ._create("limitToLast",e,"L")}class fX extends fB{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new fX(e,t,r)}_apply(e){var t;let r=f3(e,this.type,this._docOrFields,this._inclusive);return new d2(e.firestore,e.converter,(t=e._query,new oI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function fZ(...e){return fX._create("startAt",e,!0)}function f0(...e){return fX._create("startAfter",e,!1)}class f1 extends fB{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new f1(e,t,r)}_apply(e){var t;let r=f3(e,this.type,this._docOrFields,this._inclusive);return new d2(e.firestore,e.converter,(t=e._query,new oI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function f2(...e){return f1._create("endBefore",e,!1)}function f6(...e){return f1._create("endAt",e,!0)}function f3(e,t,r,n){if(r[0]=eh(r[0]),r[0]instanceof fM)return function(e,t,r,n,i){if(!n)throw new id(ic.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of oC(e))if(r.field.isKeyField())s.push(a$(t,n.key));else{let e=n.data.field(r.field);if(aS(e))throw new id(ic.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new id(ic.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new a3(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=fp(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new id(ic.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new id(ic.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!oS(e)&&-1!==l.indexOf("/"))throw new id(ic.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(iN.fromString(l));if(!iO.isDocumentKey(r))throw new id(ic.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new iO(r);o.push(a$(t,i))}else{let e=fw(r,n,l);o.push(e)}}return new a3(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function f5(e,t,r){if("string"==typeof(r=eh(r))){if(""===r)throw new id(ic.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oS(t)&&-1!==r.indexOf("/"))throw new id(ic.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(iN.fromString(r));if(!iO.isDocumentKey(n))throw new id(ic.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return a$(e,new iO(n))}if(r instanceof d6)return a$(e,r._key);throw new id(ic.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${iM(r)}.`)}function f4(e,t){if(!Array.isArray(e)||0===e.length)throw new id(ic.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function f8(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new id(ic.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new id(ic.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function f7(e,t){if(!(t instanceof fq||t instanceof f$))throw new id(ic.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function f9(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class pe extends fx{constructor(e){super(),this.firestore=e}convertBytes(e){return new fn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new d6(this.firestore,null,t)}}function pt(e){return new fP("sum",fT("sum",e))}function pr(e){return new fP("avg",fT("average",e))}function pn(){return new fP("count")}function pi(e,t){return e instanceof fP&&t instanceof fP&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function ps(e,t){return d5(e.query,t.query)&&en(e.data(),t.data())}function pa(e){return po(e,{count:pn()})}function po(e,t){var r;let n,i=iF(e.firestore,fe),s=ft(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new lf(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new ip,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await dH(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=l1(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:l6(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:l6(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=ok(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);ih(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new fL(e,new fN(i),t))}class pl{constructor(e){this.kind="memory",this._onlineComponentProvider=dR.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new dx(void 0)}}toJSON(){return{kind:this.kind}}}class pu{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=pv(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class ph{constructor(){this.kind="memoryEager",this._offlineComponentProvider=dk.provider}toJSON(){return{kind:this.kind}}}class pc{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new dx(e)}}toJSON(){return{kind:this.kind}}}function pd(){return new ph}function pf(e){return new pc(e?.cacheSizeBytes)}function pp(e){return new pl(e)}function pg(e){return new pu(e)}class pm{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=dR.provider,this._offlineComponentProvider={build:t=>new dN(t,e?.cacheSizeBytes,this.forceOwnership)}}}class py{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=dR.provider,this._offlineComponentProvider={build:t=>new dD(t,e?.cacheSizeBytes)}}}function pv(e){return new pm(e?.forceOwnership)}function pw(){return new py}let p_="NOT SUPPORTED";class pb{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pI extends fM{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(fT("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new id(ic.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=pI._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function pE(e,t,r){if(iB(t,pI._jsonSchema)){var n;if(t.bundle===p_)throw new id(ic.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=h8(e._databaseId),s=(n=t.bundle,new dM(n,i)),a=s.t(),o=new cJ(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new id(ic.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=lY(i,l[0].document),h=new iO(iN.fromString(t.bundleName));return new pI(e,new pe(e),h,u,new pb(!1,!1),r||null)}}pI._jsonSchemaVersion="firestore/documentSnapshot/1.0",pI._jsonSchema={type:iU("string",pI._jsonSchemaVersion),bundleSource:iU("string","DocumentSnapshot"),bundleName:iU("string"),bundle:iU("string")};class pT extends pI{data(e={}){return super.data(e)}}class pS{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new pb(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new pT(this._firestore,this._userDataWriter,r.key,r,new pb(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new id(ic.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new pT(e._firestore,e._userDataWriter,r.doc.key,r.doc,new pb(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new pT(e._firestore,e._userDataWriter,t.doc.key,t.doc,new pb(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return il(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new id(ic.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=pS._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=iE.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function pC(e,t,r){if(iB(t,pS._jsonSchema)){var n;if(t.bundle===p_)throw new id(ic.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=h8(e._databaseId),s=(n=t.bundle,new dM(n,i)),a=s.t(),o=new cJ(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new id(ic.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=ua(o.queries[0].bundledQuery),u=o.documents,h=new cM;u.map(e=>{let t=lY(i,e.document);h=h.add(t)});let c=cV.fromInitialDocuments(l,h,oK(),!1,!1),d=new d2(e,r||null,l);return new pS(e,new pe(e),d,c)}}function pA(e,t){return e instanceof pI&&t instanceof pI?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof pS&&t instanceof pS&&e._firestore===t._firestore&&d5(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}pS._jsonSchemaVersion="firestore/querySnapshot/1.0",pS._jsonSchema={type:iU("string",pS._jsonSchemaVersion),bundleSource:iU("string","QuerySnapshot"),bundleName:iU("string"),bundle:iU("string")};let pk={maxAttempts:5};class px{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fp(e)}set(e,t,r){this._verifyNotCommitted();let n=pN(e,this._firestore),i=f9(n.converter,t,r),s=fg(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,o8.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=pN(e,this._firestore);return i="string"==typeof(t=eh(t))||t instanceof fi?fv(this._dataReader,"WriteBatch.update",s._key,t,r,n):fy(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,o8.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=pN(e,this._firestore);return this._mutations=this._mutations.concat(new ll(t._key,o8.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new id(ic.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pN(e,t){if((e=eh(e)).firestore!==t)throw new id(ic.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class pD{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=fp(e)}get(e){let t=pN(e,this._firestore),r=new pe(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return il(24041);let n=e[0];if(n.isFoundDocument())return new fM(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new fM(this._firestore,r,t._key,null,t.converter);throw il(18433,{doc:n})})}set(e,t,r){let n=pN(e,this._firestore),i=f9(n.converter,t,r),s=fg(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=pN(e,this._firestore);return i="string"==typeof(t=eh(t))||t instanceof fi?fv(this._dataReader,"Transaction.update",s._key,t,r,n):fy(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=pN(e,this._firestore);return this._transaction.delete(t._key),this}}class pR extends pD{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=pN(e,this._firestore),r=new fN(this._firestore);return super.get(e).then(e=>new pI(this._firestore,r,t._key,e._document,new pb(!1,!1),t.converter))}}function pO(e,t,r){var n,i;let s;e=iF(e,fe);let a={...pk,...r};if(a.maxAttempts<1)throw new id(ic.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=ft(e),i=r=>t(new pR(e,r)),s=new ip,n.asyncQueue.enqueueAndForget(async()=>{let e=await dH(n);new dV(n.asyncQueue,e,a,i,s).ju()}),s.promise}function pP(e){e=iF(e,d6);let t=iF(e.firestore,fe);return dQ(ft(t),e._key).then(r=>pW(t,e,r))}function pL(e){var t;let r;e=iF(e,d6);let n=iF(e.firestore,fe),i=ft(n),s=new fN(n);return(t=e._key,r=new ip,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new id(ic.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=cL(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await dK(i),t,r)),r.promise).then(t=>new pI(n,s,e._key,t,new pb(null!==t&&t.hasLocalMutations,!0),e.converter))}function pM(e){e=iF(e,d6);let t=iF(e.firestore,fe);return dQ(ft(t),e._key,{source:"server"}).then(r=>pW(t,e,r))}function pF(e){e=iF(e,d2);let t=iF(e.firestore,fe),r=ft(t),n=new fN(t);return fV(e._query),dJ(r,e._query).then(r=>new pS(t,n,e,r))}function pV(e){var t;let r;e=iF(e,d2);let n=iF(e.firestore,fe),i=ft(n),s=new fN(n);return(t=e._query,r=new ip,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await hA(e,t,!0),i=new c0(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=cL(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await dK(i),t,r)),r.promise).then(t=>new pS(n,s,e,t))}function pU(e){e=iF(e,d2);let t=iF(e.firestore,fe),r=ft(t),n=new fN(t);return dJ(r,e._query,{source:"server"}).then(r=>new pS(t,n,e,r))}function pB(e,t,r){e=iF(e,d6);let n=iF(e.firestore,fe),i=f9(e.converter,t,r),s=fp(n);return pH(n,[fg(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,o8.none())])}function pj(e,t,r,...n){e=iF(e,d6);let i=iF(e.firestore,fe),s=fp(i);return pH(i,[("string"==typeof(t=eh(t))||t instanceof fi?fv(s,"updateDoc",e._key,t,r,n):fy(s,"updateDoc",e._key,t)).toMutation(e._key,o8.exists(!0))])}function pq(e){return pH(iF(e.firestore,fe),[new ll(e._key,o8.none())])}function pz(e,t){let r=iF(e.firestore,fe),n=function(e,t,...r){if(e=eh(e),1==arguments.length&&(t=iE.newId()),function(e,t,r){if(!r)throw new id(ic.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof d1){let n=iN.fromString(t,...r);return iP(n),new d6(e,null,new iO(n))}{if(!(e instanceof d6||e instanceof d3))throw new id(ic.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(iN.fromString(t,...r));return iP(n),new d6(e.firestore,e instanceof d3?e.converter:null,new iO(n))}}(e),i=f9(e.converter,t);return pH(r,[fg(fp(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,o8.exists(!1))]).then(()=>n)}function p$(e,...t){var r;let n,i,s,a,o;e=eh(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||fO(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(fO(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof d6)i=iF(e.firestore,fe),s=oE(e._key.path),n={next:r=>{t[u]&&t[u](pW(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=iF(e,d2);i=iF(r.firestore,fe),s=r._query;let a=new fN(i);n={next:e=>{t[u]&&t[u](new pS(i,a,r,e))},error:t[u+1],complete:t[u+2]},fV(e._query)}return r=ft(i),o=new cH(s,a=new dP(n),h),r.asyncQueue.enqueueAndForget(async()=>cq(await dW(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>cz(await dW(r),o))}}function pK(e,t,...r){var n,i,s,a,o,l;let u=eh(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new id(ic.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||fO(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&fO(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,fr(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=ft(e=iF(e,fe)),r.asyncQueue.enqueue(async()=>{var e;return e=await dK(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new d2(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=p$(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&fO(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,fr(u,h.bundle).then(()=>{t||(e=p$(new d6(u,l||null,iO.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new id(ic.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function pG(e,t){let r,n=ft(e=iF(e,fe));return r=new dP(fO(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dW(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dW(n),void e.Ca.delete(r)})}}function pH(e,t){var r;let n;return r=ft(e),n=new ip,r.asyncQueue.enqueueAndForget(async()=>dt(await dG(r),t,n)),n.promise}function pW(e,t,r){let n=r.docs.get(t._key),i=new fN(e);return new pI(e,i,t._key,n,new pb(r.hasPendingWrites,r.fromCache),t.converter)}function pQ(e){return ft(e=iF(e,fe)),new px(e,t=>pH(e,t))}function pJ(e,t){let r=ft(e=iF(e,fe));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return ia("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new id(ic.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=pY(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=fC("setIndexConfiguration",pY(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new iH(e,2)):"ASCENDING"===t.order?n.push(new iH(e,0)):"DESCENDING"===t.order&&n.push(new iH(e,1))}r.push(new iz(iz.UNKNOWN_ID,t,n,iW.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,iG,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>i2.waitFor(n)))})(await dK(r),n))}function pY(e,t){if("string"!=typeof e[t])throw new id(ic.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class pX{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function pZ(e){e=iF(e,fe);let t=p3.get(e);if(t)return t;let r=ft(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new pX(e);return p3.set(e,n),n}function p0(e){p6(e,!0)}function p1(e){p6(e,!1)}function p2(e){var t;(t=ft(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await dK(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>ii("deleting all persistent cache indexes succeeded")).catch(e=>ia("deleting all persistent cache indexes failed",e))}function p6(e,t){var r;(r=ft(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await dK(r),void(e.Cs.As=t)})).then(e=>ii(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>ia(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let p3=new WeakMap;class p5{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return p4.instance.onExistenceFilterMismatch(e)}}class p4{constructor(){this.i=new Map}static get instance(){return p8||function(e){if(ly)throw Error("a TestingHooksSpi instance is already set");ly=e}(p8=new p4),p8}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let p8=null;!function(e=!0){ie=e1,e$(new ec("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new fe(new iv(t.getProvider("auth-internal")),new iI(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new id(ic.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aN(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),e8(fD,fR,void 0),e8(fD,fR,"esm2020")}(),e.s(["AggregateField",()=>fP,"AggregateQuerySnapshot",()=>fL,"DocumentSnapshot",()=>pI,"PersistentCacheIndexManager",()=>pX,"QueryCompositeFilterConstraint",()=>f$,"QueryConstraint",()=>fB,"QueryDocumentSnapshot",()=>pT,"QueryEndAtConstraint",()=>f1,"QueryFieldFilterConstraint",()=>fq,"QueryLimitConstraint",()=>fQ,"QueryOrderByConstraint",()=>fH,"QuerySnapshot",()=>pS,"QueryStartAtConstraint",()=>fX,"SnapshotMetadata",()=>pb,"Transaction",()=>pR,"WriteBatch",()=>px,"_TestingHooks",()=>p5,"addDoc",()=>pz,"aggregateFieldEqual",()=>pi,"aggregateQuerySnapshotEqual",()=>ps,"and",()=>fG,"average",()=>pr,"count",()=>pn,"deleteAllPersistentCacheIndexes",()=>p2,"deleteDoc",()=>pq,"disablePersistentCacheIndexAutoCreation",()=>p1,"documentSnapshotFromJSON",()=>pE,"enablePersistentCacheIndexAutoCreation",()=>p0,"endAt",()=>f6,"endBefore",()=>f2,"executeWrite",()=>pH,"getAggregateFromServer",()=>po,"getCountFromServer",()=>pa,"getDoc",()=>pP,"getDocFromCache",()=>pL,"getDocFromServer",()=>pM,"getDocs",()=>pF,"getDocsFromCache",()=>pV,"getDocsFromServer",()=>pU,"getPersistentCacheIndexManager",()=>pZ,"limit",()=>fJ,"limitToLast",()=>fY,"memoryEagerGarbageCollector",()=>pd,"memoryLocalCache",()=>pp,"memoryLruGarbageCollector",()=>pf,"onSnapshot",()=>p$,"onSnapshotResume",()=>pK,"onSnapshotsInSync",()=>pG,"or",()=>fK,"orderBy",()=>fW,"persistentLocalCache",()=>pg,"persistentMultipleTabManager",()=>pw,"persistentSingleTabManager",()=>pv,"query",()=>fj,"querySnapshotFromJSON",()=>pC,"runTransaction",()=>pO,"setDoc",()=>pB,"setIndexConfiguration",()=>pJ,"snapshotEqual",()=>pA,"startAfter",()=>f0,"startAt",()=>fZ,"sum",()=>pt,"updateDoc",()=>pj,"where",()=>fz,"writeBatch",()=>pQ],75824),e.i(75824);let p7="firebasestorage.googleapis.com";class p9 extends ee{constructor(e,t,r=0){super(ge(e),`Firebase Storage: ${t} (${ge(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,p9.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ge(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function ge(e){return"storage/"+e}function gt(e){return new p9(E.INVALID_ARGUMENT,e)}function gr(){return new p9(E.APP_DELETED,"The Firebase app was deleted.")}(a=E||(E={})).UNKNOWN="unknown",a.OBJECT_NOT_FOUND="object-not-found",a.BUCKET_NOT_FOUND="bucket-not-found",a.PROJECT_NOT_FOUND="project-not-found",a.QUOTA_EXCEEDED="quota-exceeded",a.UNAUTHENTICATED="unauthenticated",a.UNAUTHORIZED="unauthorized",a.UNAUTHORIZED_APP="unauthorized-app",a.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",a.INVALID_CHECKSUM="invalid-checksum",a.CANCELED="canceled",a.INVALID_EVENT_NAME="invalid-event-name",a.INVALID_URL="invalid-url",a.INVALID_DEFAULT_BUCKET="invalid-default-bucket",a.NO_DEFAULT_BUCKET="no-default-bucket",a.CANNOT_SLICE_BLOB="cannot-slice-blob",a.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",a.NO_DOWNLOAD_URL="no-download-url",a.INVALID_ARGUMENT="invalid-argument",a.INVALID_ARGUMENT_COUNT="invalid-argument-count",a.APP_DELETED="app-deleted",a.INVALID_ROOT_OPERATION="invalid-root-operation",a.INVALID_FORMAT="invalid-format",a.INTERNAL_ERROR="internal-error",a.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class gn{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=gn.makeFromUrl(e,t)}catch(t){return new gn(e,"")}if(""===r.path)return r;throw new p9(E.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),o=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),l=t===p7?"(?:storage.googleapis.com|storage.cloud.google.com)":t,u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){let n=u[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new gn(e,t),n.postModify(r);break}}if(null==r)throw new p9(E.INVALID_URL,"Invalid URL '"+e+"'.");return r}}class gi{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function gs(e,t,r,n){if(n<t)throw gt(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw gt(`Invalid value for '${e}'. Expected ${r} or less.`)}(o=T||(T={}))[o.NO_ERROR=0]="NO_ERROR",o[o.NETWORK_ERROR=1]="NETWORK_ERROR",o[o.ABORT=2]="ABORT";class ga{constructor(e,t,r,n,i,s,a,o,l,u,h,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new go(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,a;null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let o=r.getErrorCode()===T.NO_ERROR,l=r.getStatus();!o||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),a=-1!==t.indexOf(l),(i||s||a)&&this.retry)?e(!1,new go(!1,null,r.getErrorCode()===T.ABORT)):e(!0,new go(-1!==this.successCodes_.indexOf(l),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(e){n(e)}else if(null!==i){let e=new p9(E.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?gr():new p9(E.CANCELED,"User canceled the upload/download."):new p9(E.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new go(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(d,2===o)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let r;if(l)return void c();if(e||2===o||a){c(),u.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,h(r)}let f=!1;function p(e){f||(f=!0,c(),!l&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,p(!0)},r),p}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class go{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}class gl{constructor(e,t){this._service=e,t instanceof gn?this._location=t:this._location=gn.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new gl(e,t)}get root(){let e=new gn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){var e;let t;return -1===(t=(e=this._location.path).lastIndexOf("/",e.length-2))?e:e.slice(t+1)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new gn(this._location.bucket,e);return new gl(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new p9(E.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function gu(e,t){let r=t?.storageBucket;return null==r?null:gn.makeFromBucketSpec(r,e)}class gh{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=p7,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=n?this._bucket=gn.makeFromBucketSpec(n,this._host):this._bucket=gu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=gn.makeFromBucketSpec(this._url,e):this._bucket=gu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){gs("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){gs("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(eQ(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new gl(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new gi(gr());{let s=function(e,t,r,n,i,s,a=!0,o=!1){let l=function(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}(e.urlParams),u=e.url+l,h=Object.assign({},e.headers);return t&&(h["X-Firebase-GMPID"]=t),null!==r&&r.length>0&&(h.Authorization="Firebase "+r),h["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==n&&(h["X-Firebase-AppCheck"]=n),new ga(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let gc="@firebase/storage",gd="0.14.0",gf="storage";e$(new ec(gf,function(e,{instanceIdentifier:t}){return new gh(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,e1)},"PUBLIC").setMultipleInstances(!0)),e8(gc,gd,""),e8(gc,gd,"esm2020");let gp={apiKey:A.default.env.NEXT_PUBLIC_FIREBASE_API_KEY||"mock_key_for_build",authDomain:"revolviq.io",projectId:"revolv-80ee0",storageBucket:"revolv-80ee0.firebasestorage.app",messagingSenderId:A.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"123456789",appId:A.default.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:123456789:web:abcdef"},gg=0===e5().length?e2(gp):e5()[0],gm=function(e=e3()){let t=eK(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eK(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(en(r.getOptions(),t??{}))return e;tp(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:nX,persistence:[nf,r4,r8]}),n=B("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){let t,n=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>n2)return;let i=r?.token;n6!==i&&(n6=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});eh(r).beforeAuthStateChanged(n,()=>n(r.currentUser)),eh(r).onIdTokenChanged(e=>n(e),void 0,void 0)}}let i=F("auth");return i&&function(e,t,r){let n=eh(e);tw(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=rE(t),{host:s,port:a}=function(e){let t=rE(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:rT(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:rT(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${i}//${s}${o}/`},u=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){tw(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),tw(en(l,n.config.emulator)&&en(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,q(s)?(z(`${i}//${s}${o}`),H("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"u">typeof window&&"u">typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(gg);!function(e,t){let r=eK("object"==typeof e?e:e3(),"firestore").getImmediate({identifier:"string"==typeof e?e:ax});if(!r._initialized){let e=V("firestore");e&&function(e,t,r,n={}){e=iF(e,d1);let i=q(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(z(`https://${o}`),H("Firestore",!0)),s.host!==dZ&&s.host!==o&&ia("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!en(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=n9.MOCK_USER;else{t=$(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new id(ic.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new n9(i)}e._authCredentials=new iy(new ig(t,r))}}(r,...e)}}(gg),function(e=e3(),t){let r=eK(e=eh(e),gf).getImmediate({identifier:void 0}),n=V("storage");n&&function(e,t,r,n={}){!function(e,t,r,n={}){e.host=`${t}:${r}`;let i=q(t);i&&(z(`https://${e.host}/b`),H("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:$(s,e.app.options.projectId))}(e,t,r,n)}(r,...n)}(gg);var gy=e.i(8908);let gv=(0,C.createContext)({user:null,loading:!0,signInWithGoogle:async()=>{},logout:async()=>{}}),gw=["/","/login","/signup"];function g_({children:e}){let[t,r]=(0,C.useState)(null),[n,i]=(0,C.useState)(!0),s=(0,gy.useRouter)(),a=(0,gy.usePathname)();(0,C.useEffect)(()=>{var e;let t=(e=e=>{r(e),i(!1),e||gw.includes(a)},eh(gm).onAuthStateChanged(e,void 0,void 0));return()=>t()},[a,s]);let o=async()=>{try{await nC(gm,new r$),s.push("/dashboard")}catch(e){console.error("Login failed",e)}},l=async()=>{await eh(gm).signOut(),s.push("/")};return(0,S.jsx)(gv.Provider,{value:{user:t,loading:n,signInWithGoogle:o,logout:l},children:e})}e.s(["AuthProvider",()=>g_,"useAuth",0,()=>(0,C.useContext)(gv)],54225)}]);