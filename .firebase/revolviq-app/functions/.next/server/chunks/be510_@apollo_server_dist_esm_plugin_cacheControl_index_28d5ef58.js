module.exports=[98527,e=>{"use strict";var t=e.i(73699),a=e.i(80602),n=e.i(58383),i=e.i(89434),r=e.i(22009);function l(e=Object.create(null)){let p,d;return(0,i.internalPlugin)({__internal_plugin_id__:"CacheControl",__is_disabled_plugin__:!1,async serverWillStart({schema:e}){p=new r.LRUCache({max:Object.values(e.getTypeMap()).filter(t.isCompositeType).length}),d=new r.LRUCache({max:Object.values(e.getTypeMap()).filter(t.isObjectType).flatMap(e=>Object.values(e.getFields())).length+Object.values(e.getTypeMap()).filter(t.isInterfaceType).flatMap(e=>Object.values(e.getFields())).length})},async requestDidStart(i){function r(e){let t=p.get(e);if(t)return t;let a=function(e){if(e.astNode){let t=s(e.astNode.directives);if(t)return t}if(e.extensionASTNodes)for(let t of e.extensionASTNodes){let e=s(t.directives);if(e)return e}return{}}(e);return p.set(e,a),a}let l=e.defaultMaxAge??0,h=e.calculateHttpHeaders??!0,{__testing__cacheHints:f}=e;return{async executionDidStart(){if(u(i.overallCachePolicy)){let e=(0,n.newCachePolicy)();return{willResolveField({info:t}){t.cacheControl={setCacheHint:t=>{e.replace(t)},cacheHint:e,cacheHintFromType:r}}}}return{willResolveField({info:e}){let c=(0,n.newCachePolicy)(),o=!1,p=(0,t.getNamedType)(e.returnType);if((0,t.isCompositeType)(p)){let e=r(p);c.replace(e),o=!!e.inheritMaxAge}let h=function(e){let t=d.get(e);if(t)return t;let a=function(e){if(e.astNode){let t=s(e.astNode.directives);if(t)return t}return{}}(e);return d.set(e,a),a}(e.parentType.getFields()[e.fieldName]);return h.inheritMaxAge&&void 0===c.maxAge?(o=!0,h.scope&&c.replace({scope:h.scope})):c.replace(h),e.cacheControl={setCacheHint:e=>{c.replace(e)},cacheHint:c,cacheHintFromType:r},()=>{if(void 0===c.maxAge&&((0,t.isCompositeType)(p)&&!o||!e.path.prev)&&c.restrict({maxAge:l}),f&&u(c)){let t=(0,a.responsePathAsArray)(e.path).join(".");if(f.has(t))throw Error("shouldn't happen: addHint should only be called once per path");f.set(t,{maxAge:c.maxAge,scope:c.scope})}i.overallCachePolicy.restrict(c)}}}},async willSendResponse(e){if(!h)return;let{response:t,overallCachePolicy:a}=e,i=function(e){if(!e)return{kind:"no-header"};if(e===o)return{kind:"uncacheable"};let t=c.exec(e);return t?{kind:"parsable-and-cacheable",hint:{maxAge:+t[1],scope:"public"===t[2]?"PUBLIC":"PRIVATE"}}:{kind:"unparsable"}}(t.http.headers.get("cache-control"));if("unparsable"===i.kind)return;let r=(0,n.newCachePolicy)();r.replace(a),"parsable-and-cacheable"===i.kind&&r.restrict(i.hint);let l=r.policyIfCacheable();l&&"uncacheable"!==i.kind&&"single"===t.body.kind&&!t.body.singleResult.errors?t.http.headers.set("cache-control",`max-age=${l.maxAge}, ${l.scope.toLowerCase()}`):"if-cacheable"!==h&&t.http.headers.set("cache-control",o)}}}})}let c=/^max-age=(\d+), (public|private)$/,o="no-store";function s(e){if(!e)return;let t=e.find(e=>"cacheControl"===e.name.value);if(!t||!t.arguments)return;let a=t.arguments.find(e=>"maxAge"===e.name.value),n=t.arguments.find(e=>"scope"===e.name.value),i=t.arguments.find(e=>"inheritMaxAge"===e.name.value),r=n?.value?.kind==="EnumValue"?n.value.value:void 0,l="PUBLIC"===r||"PRIVATE"===r?r:void 0;return i?.value?.kind==="BooleanValue"&&i.value.value?{inheritMaxAge:!0,scope:l}:{maxAge:a?.value?.kind==="IntValue"?parseInt(a.value.value):void 0,scope:l}}function u(e){return void 0!==e.maxAge||void 0!==e.scope}e.s(["ApolloServerPluginCacheControl",()=>l])}];

//# sourceMappingURL=be510_%40apollo_server_dist_esm_plugin_cacheControl_index_28d5ef58.js.map